<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="سیستم دوربین هوشمند امنیتی - ورود امن و سریع">
    <meta name="keywords" content="دوربین هوشمند, امنیت, ورود, سیستم">
    <meta name="author" content="Smart Camera Security System">
    <meta name="robots" content="noindex, nofollow">
    <meta name="google" content="notranslate">
    <meta name="google-translate-customization" content="notranslate">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/images/logo.png">
    <link rel="apple-touch-icon" href="/static/images/logo.png">
    
    <title>ورود به سیستم دوربین هوشمند</title>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Prevent Google Translate interference */
        .notranslate {
            font-family: inherit !important;
        }


        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light Theme Colors - Cheerful and Bright */
            --primary-color: #3b82f6;
            --secondary-color: #f59e0b;
            --accent-color: #10b981;
            --success-color: #059669;
            --danger-color: #ef4444;
            --warning-color: #f97316;
            --info-color: #06b6d4;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-heavy: 0 10px 25px rgba(0, 0, 0, 0.15);
            
            /* Dark Theme Colors - Dark and Glassy */
            --dark-primary-color: #6366f1;
            --dark-secondary-color: #8b5cf6;
            --dark-accent-color: #06b6d4;
            --dark-success-color: #10b981;
            --dark-danger-color: #ef4444;
            --dark-warning-color: #f59e0b;
            --dark-info-color: #3b82f6;
            --dark-text-primary: #f1f5f9;
            --dark-text-secondary: #cbd5e1;
            --dark-text-muted: #94a3b8;
            --dark-bg-primary: #0f172a;
            --dark-bg-secondary: #1e293b;
            --dark-bg-tertiary: #334155;
            --dark-border-color: #475569;
            --dark-border-light: #334155;
            --dark-shadow-light: 0 1px 3px rgba(0, 0, 0, 0.3);
            --dark-shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.3);
            --dark-shadow-heavy: 0 10px 25px rgba(0, 0, 0, 0.4);
            
            /* Common Variables */
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --border-radius-lg: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* Screen reader only class */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Dark Theme Override */
        [data-theme="dark"] {
            --primary-color: var(--dark-primary-color);
            --secondary-color: var(--dark-secondary-color);
            --accent-color: var(--dark-accent-color);
            --success-color: var(--dark-success-color);
            --danger-color: var(--dark-danger-color);
            --warning-color: var(--dark-warning-color);
            --info-color: var(--dark-info-color);
            --text-primary: var(--dark-text-primary);
            --text-secondary: var(--dark-text-secondary);
            --text-muted: var(--dark-text-muted);
            --bg-primary: var(--dark-bg-primary);
            --bg-secondary: var(--dark-bg-secondary);
            --bg-tertiary: var(--dark-bg-tertiary);
            --border-color: var(--dark-border-color);
            --border-light: var(--dark-border-light);
            --shadow-light: var(--dark-shadow-light);
            --shadow-medium: var(--dark-shadow-medium);
            --shadow-heavy: var(--dark-shadow-heavy);
            --glass-bg: rgba(0, 0, 0, 0.3);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* Dark Theme Message Overrides */
        [data-theme="dark"] .message {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.2);
        }

        [data-theme="dark"] .success-message {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
        }

        [data-theme="dark"] .warning-message {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
            border-color: rgba(245, 158, 11, 0.5);
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.2);
        }

        [data-theme="dark"] .info-message {
            background: rgba(14, 165, 233, 0.2);
            color: #38bdf8;
            border-color: rgba(14, 165, 233, 0.5);
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.2);
        }

        /* Message Icons Styling */
        .message i {
            margin-right: 8px;
            font-size: 1.1rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        .message.error-message i {
            animation: iconShake 0.5s ease-in-out;
        }

        .message.success-message i {
            animation: iconBounce 0.6s ease-in-out;
        }

        .message.warning-message i {
            animation: iconPulse 1.5s ease-in-out infinite;
        }

        .message.info-message i {
            animation: iconRotate 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes iconShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        @keyframes iconBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        @keyframes iconRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        /* Toast Notification Styles */
        .toast-notification {
            cursor: pointer;
            user-select: none;
        }

        .toast-notification:hover {
            transform: translateX(-5px) scale(1.02);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        }

        /* Dark theme toast adjustments */
        [data-theme="dark"] .toast-notification {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .toast-notification:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Noto Nastaliq Urdu', 'BNazanin', 'Tahoma', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);
            background-size: 400% 400%, 300% 300%, 350% 350%, 400% 400%;
            animation: gradientShift 20s ease infinite, floatingOrbs 15s ease-in-out infinite;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            direction: rtl;
            position: relative;
            color: var(--text-primary);
            transition: var(--transition);
            overflow-x: hidden;
            overflow-y: auto;
            padding-top: 100px;
            padding-bottom: 120px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            transform: translateZ(0);
            backface-visibility: hidden;
            will-change: scroll-position;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 90%, rgba(255, 255, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 10%, rgba(255, 255, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 60%);
            background-size: 200% 200%, 150% 150%, 100% 100%;
            animation: shimmerEffect 25s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            animation: morphingShapes 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
            transform: translate(-50%, -50%);
            filter: blur(2px);
        }

        /* Enhanced Font classes for different languages */
        .font-fa {
            font-family: 'Noto Nastaliq Urdu', 'BNazanin', 'Tahoma', sans-serif;
            font-weight: 500;
            line-height: 1.6;
        }

        .font-en {
            font-family: 'Inter', 'JetBrains Mono', 'Arial', sans-serif;
            font-weight: 600;
            line-height: 1.5;
            letter-spacing: -0.025em;
        }

        /* Language-specific body classes */
        body.lang-fa {
            font-family: 'Noto Nastaliq Urdu', 'BNazanin', 'Tahoma', sans-serif;
            direction: rtl;
            text-align: right;
        }

        body.lang-en {
            font-family: 'Inter', 'JetBrains Mono', 'Arial', sans-serif;
            direction: ltr;
            text-align: left;
        }

        /* Text direction based on language */
        [dir="rtl"] label,
        [dir="rtl"] .subtitle,
        [dir="rtl"] .auth-btn span,
        [dir="rtl"] .forgot-password a,
        [dir="rtl"] .social-btn span,
        [dir="rtl"] .divider span,
        [dir="rtl"] .forgot-password {
            text-align: right;
        }

        [dir="ltr"] label,
        [dir="ltr"] .subtitle,
        [dir="ltr"] .auth-btn span,
        [dir="ltr"] .forgot-password a,
        [dir="ltr"] .social-btn span,
        [dir="ltr"] .divider span,
        [dir="ltr"] .forgot-password {
            text-align: left;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes floatingOrbs {
            0%, 100% { 
                background-position: 0% 0%, 100% 100%, 50% 50%, 0% 50%; 
            }
            25% { 
                background-position: 100% 0%, 0% 100%, 100% 50%, 100% 50%; 
            }
            50% { 
                background-position: 100% 100%, 0% 0%, 50% 100%, 50% 0%; 
            }
            75% { 
                background-position: 0% 100%, 100% 0%, 0% 50%, 0% 0%; 
            }
        }
        
        @keyframes shimmerEffect {
            0%, 100% { 
                background-position: 0% 0%, 100% 100%, 50% 50%; 
                opacity: 0.3;
            }
            25% { 
                background-position: 100% 0%, 0% 100%, 100% 50%; 
                opacity: 0.5;
            }
            50% { 
                background-position: 100% 100%, 0% 0%, 50% 100%; 
                opacity: 0.7;
            }
            75% { 
                background-position: 0% 100%, 100% 0%, 0% 50%, 0% 0%; 
                opacity: 0.4;
            }
        }
        
        @keyframes morphingShapes {
            0%, 100% { 
                border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; 
            }
            25% { 
                border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; 
            }
            50% { 
                border-radius: 50% 60% 30% 60% / 60% 30% 60% 50%; 
            }
            75% { 
                border-radius: 60% 40% 60% 30% / 30% 60% 40% 60%; 
            }
        }

        /* Smart Header */
        .smart-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] .smart-header {
            background: rgba(30, 41, 59, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .smart-header.hidden {
            transform: translateY(-100%);
            opacity: 0;
        }

        .smart-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            pointer-events: auto;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .header-logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: headerLogoPulse 3s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.25);
            border: 2px solid var(--primary-color);
            background: white;
        }

        .header-logo img:hover {
            transform: scale(1.15);
        }

        .header-logo img::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: headerLogoShine 5s ease-in-out infinite;
        }

        /* Dark theme header logo effects */
        [data-theme="dark"] .header-logo img {
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        [data-theme="dark"] .header-logo img:hover {
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
        }

        /* Light theme header logo effects */
        [data-theme="light"] .header-logo img {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.25);
        }

        [data-theme="light"] .header-logo img:hover {
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .header-logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            font-family: inherit;
            transition: var(--transition);
            position: relative;
        }
        
        [data-theme="dark"] .header-logo-text {
            color: #f1f5f9;
        }



        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1001;
            position: relative;
        }

        /* Light theme header buttons */
        [data-theme="light"] .header-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1e293b;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 1002;
            position: relative;
            pointer-events: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        [data-theme="light"] .header-btn:hover {
            background: linear-gradient(135deg, #ec4899, #22c55e);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(236, 72, 153, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Dark theme header buttons */
        [data-theme="dark"] .header-btn {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            z-index: 1002;
            position: relative;
            pointer-events: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .header-btn:hover {
            background: linear-gradient(135deg, #6366f1, #06b6d4);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .header-btn:active {
            transform: translateY(0px);
            box-shadow: var(--shadow-light);
        }

        .header-btn i {
            font-size: 1rem;
        }

        /* Mobile Header - Responsive Text Sizing */
        @media (max-width: 768px) {
            .smart-header-content {
                padding: 0.75rem 1rem;
            }

            .header-logo img {
                width: 28px;
                height: 28px;
                border: 1px solid var(--primary-color);
                box-shadow: 0 3px 10px rgba(79, 70, 229, 0.2);
            }

            .header-logo-text {
                font-size: 0.85rem;
                font-weight: 600;
            }

            .header-controls {
                gap: 0.4rem;
            }

            .header-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.7rem;
                min-width: auto;
            }

            .header-btn i {
                font-size: 0.8rem;
            }
        }

        /* Extra Small Mobile */
        @media (max-width: 480px) {
            .smart-header-content {
                padding: 0.5rem 0.75rem;
            }

            .header-logo img {
                width: 24px;
                height: 24px;
                border: 1px solid var(--primary-color);
                box-shadow: 0 2px 8px rgba(79, 70, 229, 0.15);
            }

            .header-logo-text {
                font-size: 0.75rem;
                font-weight: 600;
            }

            .header-controls {
                gap: 0.3rem;
            }

            .header-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.65rem;
                min-width: auto;
            }

            .header-btn i {
                font-size: 0.7rem;
            }
        }

        /* Glass Footer */
        .glass-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1.5rem 0;
            text-align: center;
            transition: var(--transition);
            transform: translateY(0);
            opacity: 1;
            /* Ensure footer is always at bottom */
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="dark"] .glass-footer {
            background: rgba(30, 41, 59, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        .glass-footer.hidden {
            transform: translateY(100%);
            opacity: 0;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .footer-text {
            color: #475569;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        [data-theme="dark"] .footer-text {
            color: #94a3b8;
        }

        .footer-text i {
            color: var(--danger-color);
            animation: heartbeat 2s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .footer-links {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-link {
            color: #475569;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 8px 12px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        [data-theme="dark"] .footer-link {
            color: #94a3b8;
        }

        .footer-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.4s ease;
        }

        .footer-link:hover {
            color: var(--primary-color);
            transform: translateY(-2px);
            background: rgba(59, 130, 246, 0.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .footer-link:hover::before {
            left: 100%;
        }

        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1023px) {
            body {
                padding-top: 70px;
                padding-bottom: 100px;
            }
            
            .main-container {
                margin-top: 80px;
                margin-bottom: 150px;
                min-height: calc(100vh - 80px - 150px);
                padding: 0 1.5rem;
            }
            
            .auth-container {
                max-width: 500px;
                min-height: 500px;
                padding: 30px 25px;
            }
            
            h1 {
                font-size: 1.4rem;
                margin-bottom: 25px;
            }
            
            .auth-tabs {
                gap: 8px;
                margin-bottom: 25px;
                padding: 8px;
            }
            
            .auth-tab {
                padding: 14px 16px;
                font-size: 1rem;
                border-radius: 12px;
            }
            
            .auth-tab:hover {
                transform: translateY(-3px) scale(1.03);
            }
            
            .auth-tab.active {
                transform: translateY(-4px) scale(1.05);
            }

            /* Tablet theme-specific auth tabs */
            [data-theme="light"] .auth-tab {
                background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
                color: #475569;
            }

            [data-theme="dark"] .auth-tab {
                background: linear-gradient(135deg, #334155, #475569);
                color: #cbd5e1;
            }
            
            input {
                padding: 16px 16px 16px 45px;
                font-size: 1rem;
            }
            
            .input-group i {
                font-size: 1.2rem;
                left: 20px;
            }

            .password-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                right: 20px;
            }

            [dir="rtl"] .password-toggle {
                right: auto;
                left: 20px;
            }
            
            .auth-btn {
                padding: 16px;
                font-size: 1.1rem;
                margin-top: 20px;
            }
            
            .header-logo img {
                width: 32px;
                height: 32px;
            }
            
            .header-logo-text {
                font-size: 1.1rem;
            }
            
            .header-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .footer-links {
                gap: 1.5rem;
            }

            .footer-link {
                font-size: 0.85rem;
                padding: 6px 10px;
            }
        }

        /* Mobile Footer */
        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0 1rem;
            }

            .footer-text {
                font-size: 0.75rem;
            }

            .footer-links {
                gap: 1rem;
            }

            .footer-link {
                font-size: 0.75rem;
            }
            
            /* Mobile background optimization */
            body::after {
                width: 200px;
                height: 200px;
                filter: blur(3px);
            }
            
            body {
                background-size: 300% 300%, 250% 250%, 300% 300%, 300% 300%;
                animation: gradientShift 15s ease infinite, floatingOrbs 12s ease-in-out infinite;
            }
            
            body::before {
                background-size: 150% 150%, 120% 120%, 80% 80%;
                animation: shimmerEffect 20s ease-in-out infinite;
            }

            /* Mobile captcha improvements */
            .captcha-container {
                padding: 16px;
                gap: 15px;
            }

            .captcha-container canvas {
                width: 220px !important;
                height: 65px !important;
                margin: 10px 0;
            }

            .captcha-input {
                max-width: 280px;
                font-size: 1.1rem;
                padding: 14px 16px;
                letter-spacing: 2px;
                font-weight: 700;
            }

            .captcha-container .input-group {
                max-width: 250px;
            }
            
            /* Mobile main container adjustments */
            .main-container {
                margin-bottom: 120px; /* Reduced spacing to footer on mobile */
                min-height: calc(100vh - 80px - 120px); /* Adjusted for mobile */
                padding: 0 1rem;
            }
            
            body {
                padding-bottom: 120px; /* Reduced padding for footer on mobile */
            }
            
            /* Mobile message adjustments */
            .message {
                padding: 12px 16px;
                font-size: 0.9rem;
                margin-bottom: 15px;
            }
            
            .message i {
                font-size: 1rem;
                margin-right: 6px;
            }

            .password-toggle {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
                right: 12px;
                padding: 6px;
            }

            [dir="rtl"] .password-toggle {
                right: auto;
                left: 12px;
            }
            
            /* Mobile toast adjustments */
            .toast-notification {
                max-width: 280px !important;
                min-width: 250px !important;
                top: 10px !important;
                right: 10px !important;
                font-size: 0.85rem;
            }
        }

        /* Performance-based animation adjustments */
        @media (prefers-reduced-motion: reduce) {
            .auth-container {
                animation: none !important;
            }
            
            .auth-tab {
                transition: none !important;
            }
        }
        
        /* Low-end device optimizations */
        @media (max-width: 768px) and (max-height: 1024px) {
            .auth-container {
                backdrop-filter: blur(5px) !important;
            }
        }
        
        /* High-end device optimizations */
        @media (min-width: 1200px) and (min-height: 800px) {
            .auth-container {
                backdrop-filter: blur(15px) !important;
            }
        }
        
        /* Accessibility improvements */
        @media (prefers-contrast: high) {
            .auth-container {
                border: 2px solid var(--text-primary) !important;
                background: var(--bg-primary) !important;
            }
            
            .auth-tab {
                border: 1px solid var(--text-primary) !important;
            }
        }
        
        /* Print styles */
        @media print {
            .glass-header,
            .glass-footer {
                display: none !important;
            }
            
            .auth-container {
                box-shadow: none !important;
                border: 1px solid #000 !important;
            }
        }
        
        /* Enhanced Theme Backgrounds */
        [data-theme="light"] body {
            background: 
                radial-gradient(circle at 20% 80%, rgba(236, 72, 153, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(34, 197, 94, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #fefefe 0%, #f8fafc 50%, #f1f5f9 100%);
            background-size: 400% 400%, 300% 300%, 350% 350%, 400% 400%;
        }
        
        [data-theme="light"] body::before {
            background: 
                radial-gradient(circle at 10% 90%, rgba(236, 72, 153, 0.06) 0%, transparent 40%),
                radial-gradient(circle at 90% 10%, rgba(34, 197, 94, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.03) 0%, transparent 60%);
        }
        
        [data-theme="light"] body::after {
            background: linear-gradient(45deg, rgba(236, 72, 153, 0.08), rgba(34, 197, 94, 0.04));
        }

        [data-theme="dark"] body {
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            background-size: 400% 400%, 300% 300%, 350% 350%, 400% 400%;
        }
        
        [data-theme="dark"] body::before {
            background: 
                radial-gradient(circle at 10% 90%, rgba(99, 102, 241, 0.12) 0%, transparent 40%),
                radial-gradient(circle at 90% 10%, rgba(6, 182, 212, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.06) 0%, transparent 60%);
        }
        
        [data-theme="dark"] body::after {
            background: linear-gradient(45deg, rgba(99, 102, 241, 0.15), rgba(6, 182, 212, 0.08));
        }
        /* Smooth scrolling optimization */
        html {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Optimize scrolling performance */
        * {
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        /* Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Optimized smooth theme transitions */
        .theme-transitioning * {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        .theme-transitioning {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        /* Enhanced particle glow effect */
        .particle::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            background: inherit;
            filter: blur(4px);
            opacity: 0.3;
            z-index: -1;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Optimized animation durations for variety */
        .particle:nth-child(odd) {
            animation-duration: 6s;
            animation-delay: -0.5s;
        }

        .particle:nth-child(3n) {
            animation-duration: 8s;
            animation-delay: -1s;
        }

        .particle:nth-child(4n) {
            animation-duration: 5s;
            animation-delay: -1.5s;
        }

        .particle:nth-child(5n) {
            animation-duration: 7s;
            animation-delay: -2s;
        }



        @keyframes modalFadeIn {
            from {
                opacity: 0;
                height: auto;
                min-height: 100vh;
            }
            to {
                opacity: 1;
                height: auto;
                min-height: 100vh;
            }
        }

        .modal-overlay.active {
            animation: modalFadeIn 0.4s ease-out;
            height: auto;
            min-height: 100vh;
        }

        .modal-overlay.active .modal-container {
            animation: modalSlideIn 0.4s ease-out;
            height: auto;
            min-height: 400px;
        }






        .mobile-login-steps {
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px 0;
            /* Ensure steps are properly displayed */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            /* Responsive adjustments */
            box-sizing: border-box;
            height: auto;
            min-height: 200px;
        }

        .step {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px);
            animation-fill-mode: forwards;
            /* Ensure step is properly displayed */
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            /* Responsive step layout */
            box-sizing: border-box;
            height: auto;
            min-height: 150px;
        }

        .step.active {
            opacity: 1;
            transform: translateY(0);
            height: auto;
            min-height: 150px;
        }

        /* Enhanced step transitions */
        .step-enter {
            animation: stepSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            height: auto;
            min-height: 150px;
        }

        .step-exit {
            animation: stepSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            height: auto;
            min-height: 150px;
        }

        @keyframes stepSlideIn {
            from {
                opacity: 0;
                transform: translateX(30px) scale(0.95);
                height: auto;
                min-height: 150px;
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
                height: auto;
                min-height: 150px;
            }
        }

        @keyframes stepSlideOut {
            from {
                opacity: 1;
                transform: translateX(0) scale(1);
                height: auto;
                min-height: 150px;
            }
            to {
                opacity: 0;
                transform: translateX(-30px) scale(0.95);
                height: auto;
                min-height: 150px;
            }
        }

        /* CAPTCHA Styles */
        .captcha-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            height: auto;
            min-height: 100px;
        }

        /* Desktop captcha container - vertical layout */
        @media (min-width: 768px) {
            .captcha-container:not(.mobile-captcha) {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            /* Desktop modal captcha improvements */
            .modal-container .captcha-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
                padding: 20px;
                border-radius: 16px;
            }
            
            .modal-container .captcha-container canvas {
                width: 300px !important;
                height: 80px !important;
                border-radius: 12px;
            }
            
            .modal-container .captcha-input {
                max-width: 320px;
                font-size: 1.2rem;
                padding: 16px 20px;
                border-radius: 14px;
            }
        }

        .captcha-image {
            flex: 1;
            display: flex;
            justify-content: center;
            height: auto;
            min-height: 50px;
        }

        #mobile-captcha-canvas {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        #mobile-captcha-canvas:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
            border-color: var(--primary-color);
        }
        
        #mobile-captcha-canvas:active {
            transform: translateY(0px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .captcha-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: auto;
            min-height: 50px;
        }

        .captcha-refresh-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .captcha-refresh-btn:hover {
            background: var(--accent-color);
            transform: scale(1.05);
        }

        .captcha-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 14px;
            font-size: 1.1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            text-align: center;
            letter-spacing: 3px;
            font-weight: 700;
            height: auto;
            min-height: 50px;
            line-height: 1.2;
        }

        .captcha-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }

        /* Loading Button Styles */
        .btn-loading {
            display: none;
            height: auto;
            min-height: 20px;
        }

        .btn-loading.show {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-text {
            display: inline;
            height: auto;
            min-height: 20px;
        }

        .btn-text.hide {
            display: none;
            height: auto;
            min-height: 20px;
        }

        /* Enhanced Timer Styles */
        .otp-timer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            padding: 16px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            height: auto;
            min-height: 50px;
        }

        .otp-timer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            animation: timerShine 2s ease-in-out infinite;
        }

        @keyframes timerShine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .timer {
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
            background: rgba(59, 130, 246, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            height: auto;
            min-height: 30px;
        }

        .timer.expired {
            color: var(--danger-color);
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.2);
            animation: timerPulse 1s ease-in-out infinite;
        }

        @keyframes timerPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
            }
        }

        .step-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 50%, var(--secondary-color) 100%);
            background-size: 200% 200%;
            animation: gradientShift 4s ease infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 28px;
            font-size: 2.5rem;
            color: white;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 10px 25px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }
        .step-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: iconShine 2s ease-in-out infinite;
            height: auto;
            min-height: 100px;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes iconShine {
            0% { 
                left: -100%; 
                height: auto;
                min-height: 100px;
            }
            50% { 
                left: 100%; 
                height: auto;
                min-height: 100px;
            }
            100% { 
                left: 100%; 
                height: auto;
                min-height: 100px;
            }
        }

        .step-icon:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 10px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            height: auto;
            min-height: 100px;
        }

        .step-icon.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            animation: successPulse 2s ease-in-out infinite;
            height: auto;
            min-height: 100px;
        }

        @keyframes successPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
                height: auto;
                min-height: 100px;
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 20px 40px rgba(16, 185, 129, 0.6);
                height: auto;
                min-height: 100px;
            }
        }

        .step h4 {
            font-size: 1.5rem;
            margin: 0 0 12px;
            color: var(--text-primary);
            font-weight: 700;
            height: auto;
            min-height: 30px;
        }

        .step-description {
            color: var(--text-secondary);
            margin-bottom: 32px;
            line-height: 1.6;
            font-size: 1rem;
            height: auto;
            min-height: 40px;
        }

        .mobile-form {
            text-align: center;
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            /* Responsive form layout */
            box-sizing: border-box;
            height: auto;
            min-height: 200px;
        }

        .phone-input-container {
            display: flex;
            align-items: center;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-secondary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            margin-bottom: 20px;
            /* Responsive phone input layout */
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            height: auto;
            min-height: 60px;
        }

        .phone-input-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            padding: 2px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color), var(--secondary-color));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .phone-input-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.15),
                0 8px 25px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .phone-input-container:focus-within::before {
            opacity: 1;
        }

        .country-code {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            padding: 18px 24px;
            font-weight: 700;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            height: auto;
            min-height: 50px;
        }

        .country-code::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: codeShine 2s ease-in-out infinite;
        }

        @keyframes codeShine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .phone-input {
            flex: 1;
            border: none;
            padding: 18px 24px;
            font-size: 1.2rem;
            font-weight: 600;
            background: transparent;
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s ease;
            height: auto;
            min-height: 50px;
        }

        .phone-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
            font-weight: 400;
        }

        .phone-input:focus::placeholder {
            opacity: 0.5;
            transform: translateX(5px);
        }

        .input-help {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
            text-align: center;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            font-weight: 500;
            transition: all 0.3s ease;
            height: auto;
            min-height: 30px;
        }

        .input-help:hover {
            background: rgba(59, 130, 246, 0.08);
            border-color: rgba(59, 130, 246, 0.15);
            transform: translateY(-1px);
        }

        /* Enhanced form group styling for mobile modal */
        .mobile-form .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .mobile-form .form-group:last-child {
            margin-bottom: 0;
        }

        /* Success actions styling */
        .success-actions {
            margin-top: 32px;
            text-align: center;
            height: auto;
            min-height: 60px;
        }

        .success-actions .modal-btn {
            min-width: 200px;
            margin: 0 auto;
            height: auto;
            min-height: 60px;
        }

        /* Enhanced loading states for modal */
        .modal-loading {
            position: relative;
            pointer-events: none;
            height: auto;
            min-height: 100px;
        }

        .modal-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 24px;
            height: auto;
            min-height: 100px;
        }

        .modal-loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: modalSpin 1s linear infinite;
            z-index: 11;
            transform: translate(-50%, -50%);
            height: auto;
            min-height: 40px;
        }

        @keyframes modalSpin {
            0% { 
                transform: translate(-50%, -50%) rotate(0deg); 
                height: auto;
                min-height: 40px;
            }
            100% { 
                transform: translate(-50%, -50%) rotate(360deg); 
                height: auto;
                min-height: 40px;
            }
        }

        /* Enhanced focus management for accessibility */
        .modal-container:focus {
            outline: none;
            height: auto;
            min-height: 400px;
        }

        .modal-container:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
            height: auto;
            min-height: 400px;
        }

        /* Improved mobile modal accessibility */
        .modal-overlay[aria-hidden="true"] {
            display: none;
            height: auto;
            min-height: 100vh;
        }

        .modal-overlay[aria-hidden="false"] {
            display: flex;
            height: auto;
            min-height: 100vh;
        }

        .otp-input-container {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            /* Responsive OTP layout */
            width: 100%;
            box-sizing: border-box;
            height: auto;
            min-height: 60px;
        }

        .otp-input {
            width: 52px;
            height: 64px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            border: 2px solid var(--border-color);
            border-radius: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .otp-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 14px;
            padding: 2px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .otp-input:focus {
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.15),
                0 8px 20px rgba(59, 130, 246, 0.2);
            transform: scale(1.05) translateY(-2px);
            background: var(--bg-primary);
        }

        .otp-input:focus::before {
            opacity: 1;
        }

        .otp-input:focus::placeholder {
            opacity: 0.5;
        }

        .otp-input.filled {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .direct-otp-input {
            width: 100%;
            padding: 20px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            letter-spacing: 2px;
        }
        
        .direct-otp-input:focus {
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.15),
                0 8px 20px rgba(59, 130, 246, 0.2);
            transform: scale(1.02);
            background: var(--bg-primary);
        }
        
        .direct-otp-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
        


        .otp-timer {
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
        }

        .timer {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .modal-buttons {
            display: flex;
            gap: 16px;
            flex-direction: column;
            margin-top: 24px;
            /* Responsive button layout */
            width: 100%;
            box-sizing: border-box;
            align-items: center;
            height: auto;
            min-height: 80px;
        }

        .modal-btn {
            padding: 20px 36px;
            border: none;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            min-width: 200px;
            height: auto;
            min-height: 60px;
        }

        .modal-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .modal-btn:hover::before {
            left: 100%;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 50%, var(--secondary-color) 100%);
            background-size: 200% 200%;
            animation: gradientShift 4s ease infinite;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .modal-btn.primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(59, 130, 246, 0.4),
                0 8px 20px rgba(59, 130, 246, 0.3);
            background-position: 100% 50%;
        }

        .modal-btn.primary:active {
            transform: translateY(-1px) scale(0.98);
        }

        .modal-btn.secondary {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .modal-btn.secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--border-color) 0%, var(--primary-color) 100%);
            color: white;
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.25);
            border-color: var(--primary-color);
        }

        .modal-btn.secondary:active:not(:disabled) {
            transform: translateY(0) scale(0.99);
        }

        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            animation: none !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }

        .modal-btn:disabled::before {
            display: none;
        }

        .success-actions {
            margin-top: 30px;
        }

        /* Enhanced Responsive Modal Design */
        
        /* Desktop Modal Styles - Professional & Centered */
        @media (min-width: 769px) {
            .modal-overlay {
                padding: 40px;
                align-items: center;
                justify-content: center;
                background: rgba(0, 0, 0, 0.85);
                backdrop-filter: blur(30px);
            }

            .modal-container {
                max-width: 520px;
                width: 100%;
                margin: 0 auto;
                border-radius: 28px;
                max-height: 90vh;
                min-height: 450px;
                height: auto;
                transform: scale(1) translateY(0) !important;
                box-shadow: 
                    0 40px 80px rgba(0, 0, 0, 0.5),
                    0 20px 40px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
                overflow: visible;
            }

            .modal-header {
                padding: 28px 32px 24px;
                border-radius: 28px 28px 0 0;
            }

            .modal-title {
                font-size: 1.6rem;
                font-weight: 700;
            }

            .modal-close-btn {
                width: 44px;
                height: 44px;
                font-size: 1.3rem;
                background: rgba(255, 255, 255, 0.25);
                border: 2px solid rgba(255, 255, 255, 0.4);
            }

            .modal-body {
                padding: 32px 28px;
                max-height: calc(90vh - 120px);
                overflow-y: auto;
                height: auto;
                min-height: 300px;
            }

            .mobile-login-steps {
                max-width: 100%;
                padding: 20px 0;
            }

            .step-icon {
                width: 90px;
                height: 90px;
                font-size: 2.2rem;
                margin-bottom: 28px;
            }

            .step h4 {
                font-size: 1.4rem;
                margin-bottom: 12px;
                font-weight: 700;
            }

            .step-description {
                font-size: 1.1rem;
                margin-bottom: 32px;
                line-height: 1.6;
            }

            .phone-input-container {
                flex-direction: row;
                margin-bottom: 24px;
                border-radius: 16px;
            }

            .country-code {
                padding: 16px 20px;
                font-size: 1.1rem;
                font-weight: 700;
            }

            .phone-input {
                padding: 16px 20px;
                font-size: 1.1rem;
            }

            .otp-input {
                width: 56px;
                height: 68px;
                font-size: 1.4rem;
            }

            .modal-btn {
                padding: 18px 32px;
                font-size: 1.1rem;
                min-width: 180px;
                border-radius: 16px;
            }

            .modal-buttons {
                gap: 16px;
                margin-top: 28px;
            }

            .captcha-container {
                padding: 16px;
                margin-bottom: 20px;
                border-radius: 14px;
            }

            .captcha-container canvas {
                width: 220px !important;
                height: 56px !important;
            }
            
            .mobile-captcha .captcha-canvas {
                width: 220px !important;
                height: 56px !important;
            }

            .captcha-input {
                max-width: 240px;
                font-size: 1rem;
                padding: 12px 16px;
            }

            .otp-timer {
                padding: 20px;
                margin: 24px 0;
            }

            .timer {
                font-size: 1.2rem;
                padding: 10px 16px;
            }

            .input-help {
                font-size: 0.95rem;
                margin-top: 12px;
                padding: 10px 14px;
            }
        }

        /* Tablet Modal Styles */
        @media (min-width: 769px) and (max-width: 1023px) {
            .modal-overlay {
                padding: 30px;
            }

            .modal-container {
                max-width: 480px;
                min-height: 420px;
            }

            .modal-header {
                padding: 24px 28px 20px;
            }

            .modal-title {
                font-size: 1.4rem;
            }

            .modal-body {
                padding: 28px 24px;
            }

            .step-icon {
                width: 80px;
                height: 80px;
                font-size: 2rem;
                margin-bottom: 24px;
            }

            .step h4 {
                font-size: 1.3rem;
            }

            .step-description {
                font-size: 1rem;
                margin-bottom: 28px;
            }

            .otp-input {
                width: 50px;
                height: 60px;
                font-size: 1.3rem;
            }

            .modal-btn {
                padding: 16px 28px;
                font-size: 1rem;
                min-width: 160px;
            }
        }

        /* Large Desktop Modal Styles */
        @media (min-width: 1024px) {
            .modal-overlay {
                padding: 50px;
            }

            .modal-container {
                max-width: 560px;
                min-height: 480px;
                height: auto;
                border-radius: 32px;
                overflow: visible;
            }

            .modal-header {
                padding: 32px 36px 28px;
                border-radius: 32px 32px 0 0;
            }

            .modal-title {
                font-size: 1.8rem;
            }

            .modal-close-btn {
                width: 48px;
                height: 48px;
                font-size: 1.4rem;
            }

            .modal-body {
                padding: 36px 32px;
                height: auto;
                min-height: 350px;
            }

            .step-icon {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
                margin-bottom: 32px;
            }

            .step h4 {
                font-size: 1.5rem;
                margin-bottom: 16px;
            }

            .step-description {
                font-size: 1.2rem;
                margin-bottom: 36px;
            }

            .otp-input {
                width: 60px;
                height: 72px;
                font-size: 1.5rem;
            }

            .modal-btn {
                padding: 20px 36px;
                font-size: 1.2rem;
                min-width: 200px;
                border-radius: 18px;
            }

            .captcha-container canvas {
                width: 240px !important;
                height: 60px !important;
            }
            
            .mobile-captcha .captcha-canvas {
                width: 240px !important;
                height: 60px !important;
            }

            .captcha-input {
                max-width: 260px;
                font-size: 1.1rem;
                padding: 14px 18px;
            }
        }

        /* --- Fix: Modal always stick to bottom of page --- */
        .modal-overlay {
            display: flex !important;
            flex-direction: column;
            justify-content: flex-end !important;
            align-items: center;
            min-height: 100vh;
            height: 100vh;
            padding: 0 !important;
        }

        .modal-container {
            margin: 0 !important;
            min-height: 40vh;
            max-height: 100vh;
            width: 100%;
            border-radius: 24px 24px 0 0 !important;
            box-shadow: 0 0 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        /* Remove extra margin/padding at bottom */
        .modal-body {
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
        }

        /* If modal-footer exists, stick it to bottom */
        .modal-footer {
            margin-top: auto;
            padding-bottom: 0 !important;
            border-radius: 0 0 24px 24px;
        }

        @media (min-width: 769px) {
          .modal-overlay {
            justify-content: center !important;
            padding: 40px !important;
          }
          .modal-container {
            border-radius: 28px !important;
            max-width: 520px;
            margin-bottom: 0 !important;
          }
        }
        /* Mobile Login Integration Styles */
        .mobile-login-steps {
                max-width: 100%;
            padding: 30px 0;
                width: 100%;
        }

        .step {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px);
            animation-fill-mode: forwards;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            color: white;
            font-size: 2.5rem;
            box-shadow: 
                0 15px 40px rgba(102, 126, 234, 0.4),
                0 8px 25px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: iconShimmer 3s ease-in-out infinite;
        }

        @keyframes iconShimmer {
            0%, 100% { transform: translateX(-100%) rotate(45deg); }
            50% { transform: translateX(100%) rotate(45deg); }
        }

        .step-icon.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 
                0 12px 35px rgba(16, 185, 129, 0.4),
                0 6px 20px rgba(16, 185, 129, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            animation: successPulse 2s ease-in-out infinite;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .step h4 {
            font-size: 1.6rem;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .step-description {
                font-size: 1.1rem;
            margin-bottom: 35px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .phone-input-container {
            display: flex;
            border: 2px solid var(--border-color);
            border-radius: 18px;
            overflow: hidden;
            background: var(--input-bg);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            max-width: 400px;
            margin: 0 auto;
        }

        .phone-input-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(102, 126, 234, 0.02));
            pointer-events: none;
        }

        .phone-input-container:focus-within {
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 3px rgba(102, 126, 234, 0.1),
                0 8px 25px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .country-code {
            background: var(--primary-color);
            color: white;
            padding: 14px 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            font-size: 1.1rem;
        }

        .phone-input {
            flex: 1;
            border: none;
            padding: 14px 18px;
            font-size: 1.1rem;
            background: transparent;
            color: var(--text-primary);
        }

        .phone-input:focus {
            outline: none;
        }

        .input-help {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
            text-align: center;
        }

        .mobile-captcha {
            margin: 25px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .mobile-captcha .captcha-image {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .mobile-captcha .captcha-canvas {
            width: 300px !important;
            height: 80px !important;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mobile-captcha .captcha-canvas:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
            border-color: var(--primary-color);
        }
        
        .mobile-captcha .captcha-canvas:active {
            transform: translateY(0px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced mobile captcha tooltip and accessibility */
        .mobile-captcha .captcha-image {
            position: relative;
        }
        
        .mobile-captcha .captcha-image::after {
            content: '🔄';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
            opacity: 0.6;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        
        .mobile-captcha .captcha-image:hover::after {
            opacity: 1;
        }
        
        /* Focus styles for accessibility */
        .mobile-captcha .captcha-canvas:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* Keyboard navigation support */
        .mobile-captcha .captcha-canvas:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .captcha-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            font-size: 1.1rem;
            background: var(--input-bg);
            color: var(--text-primary);
            margin-top: 12px;
        }

        .captcha-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .otp-input-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            padding: 15px;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
        }

        .otp-input {
            width: 60px;
                height: 70px;
            border: 2px solid var(--border-color);
            border-radius: 18px;
            text-align: center;
                font-size: 1.8rem;
            font-weight: 600;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .otp-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 
                0 0 0 3px rgba(102, 126, 234, 0.1),
                0 8px 25px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px) scale(1.05);
        }

        .otp-timer {
            text-align: center;
            margin: 15px 0;
            color: var(--text-secondary);
        }

        .timer {
            font-weight: 600;
            color: var(--primary-color);
        }

        .mobile-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 35px;
            flex-wrap: wrap;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .mobile-buttons .auth-btn {
            flex: 1;
            min-width: 140px;
            max-width: 200px;
        }

        /* Light theme secondary button */
        [data-theme="light"] .mobile-buttons .auth-btn.secondary {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 25px rgba(148, 163, 184, 0.3),
                0 4px 15px rgba(148, 163, 184, 0.2);
        }

        [data-theme="light"] .mobile-buttons .auth-btn.secondary:hover {
            background: linear-gradient(135deg, #64748b, #475569);
            box-shadow: 
                0 15px 35px rgba(148, 163, 184, 0.4),
                0 8px 20px rgba(148, 163, 184, 0.3);
        }

        /* Dark theme secondary button */
        [data-theme="dark"] .mobile-buttons .auth-btn.secondary {
            background: linear-gradient(135deg, #475569, #334155);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 25px rgba(71, 85, 105, 0.4),
                0 4px 15px rgba(71, 85, 105, 0.3);
        }

        [data-theme="dark"] .mobile-buttons .auth-btn.secondary:hover {
            background: linear-gradient(135deg, #334155, #1e293b);
            box-shadow: 
                0 15px 35px rgba(71, 85, 105, 0.5),
                0 8px 20px rgba(71, 85, 105, 0.4);
        }



        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .step {
                max-width: 100%;
                margin-bottom: 30px;
            }

            .step-icon {
                width: 80px;
                height: 80px;
                font-size: 2rem;
                margin-bottom: 25px;
            }

            .step h4 {
                font-size: 1.4rem;
                margin-bottom: 12px;
                font-weight: 600;
            }

            .step-description {
                font-size: 1rem;
                margin-bottom: 30px;
                line-height: 1.5;
            }

            .phone-input-container {
                flex-direction: row;
                margin-bottom: 20px;
                border-radius: 16px;
                max-width: 350px;
            }

            .country-code {
                padding: 12px 16px;
                font-size: 1rem;
                font-weight: 600;
                min-width: 60px;
            }

            .phone-input {
                padding: 12px 16px;
                font-size: 0.95rem;
            }

            .otp-input {
                width: 42px;
                height: 52px;
                font-size: 1.2rem;
            }

            .modal-btn {
                padding: 14px 24px;
                font-size: 0.95rem;
                min-width: 160px;
                border-radius: 12px;
            }

            .modal-buttons {
                gap: 12px;
                margin-top: 20px;
            }

            .captcha-container {
                padding: 12px;
                margin-bottom: 16px;
            }

            .captcha-container canvas {
                width: 180px !important;
                height: 48px !important;
            }
            
            .mobile-captcha .captcha-canvas {
                width: 180px !important;
                height: 48px !important;
            }

            .captcha-input {
                max-width: 200px;
                font-size: 0.9rem;
                padding: 10px 12px;
            }
        }

        @media (max-width: 480px) {
            .modal-overlay {
                padding: 5px;
                align-items: flex-start;
                padding-top: 10px;
            }

            .modal-container {
                max-width: 100%;
                width: 100%;
                margin: 0;
                border-radius: 16px;
                max-height: calc(100vh - 20px);
                min-height: auto;
                transform: none !important;
            }

            .modal-header {
                padding: 18px 20px 14px;
                border-radius: 16px 16px 0 0;
            }

            .modal-title {
                font-size: 1.1rem;
                font-weight: 700;
            }

            .modal-close-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
                background: rgba(255, 255, 255, 0.25);
                border: 1px solid rgba(255, 255, 255, 0.4);
            }

            .modal-body {
                padding: 20px 16px;
                max-height: calc(100vh - 100px);
                overflow-y: auto;
            }

            .mobile-login-steps {
                max-width: 100%;
                padding: 8px 0;
            }

            .step-icon {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
                margin-bottom: 16px;
            }

            .step h4 {
                font-size: 1rem;
                margin-bottom: 6px;
                font-weight: 600;
            }

            .step-description {
                font-size: 0.85rem;
                margin-bottom: 20px;
                line-height: 1.4;
            }

            /* Enhanced mobile captcha */
            .captcha-container {
                padding: 10px;
                gap: 8px;
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .captcha-container canvas {
                width: 160px !important;
                height: 44px !important;
                margin: 6px 0;
            }

            .captcha-input {
                max-width: 180px;
                font-size: 0.9rem;
                padding: 10px 12px;
            }

            .captcha-container .input-group {
                max-width: 180px;
            }

            .otp-input {
                width: 38px;
                height: 48px;
                font-size: 1.1rem;
            }

            .phone-input-container {
                flex-direction: row;
                border-radius: 12px;
                margin-bottom: 12px;
            }

            .country-code {
                padding: 10px 14px;
                font-size: 0.9rem;
                font-weight: 600;
            }

            .phone-input {
                padding: 10px 14px;
                font-size: 0.9rem;
            }

            .modal-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
                border-radius: 12px;
                min-width: 140px;
            }

            .modal-buttons {
                gap: 10px;
                margin-top: 16px;
            }

            .input-help {
                font-size: 0.75rem;
                margin-top: 6px;
                padding: 6px 10px;
            }

            .otp-timer {
                padding: 12px;
                margin: 16px 0;
            }

            .timer {
                font-size: 1rem;
                padding: 6px 10px;
            }
        }

        @media (max-width: 360px) {

            .mobile-login-steps {
                max-width: 100%;
                padding: 6px 0;
            }

            .step-icon {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
                margin-bottom: 14px;
            }

            .step h4 {
                font-size: 0.9rem;
                margin-bottom: 5px;
                font-weight: 600;
            }

            .step-description {
                font-size: 0.8rem;
                margin-bottom: 18px;
                line-height: 1.3;
            }

            .otp-input {
                width: 35px;
                height: 44px;
                font-size: 1rem;
            }

            .phone-input-container {
                border-radius: 10px;
                margin-bottom: 10px;
            }

            .country-code {
                padding: 8px 12px;
                font-size: 0.85rem;
                font-weight: 600;
            }

            .phone-input {
                padding: 8px 12px;
                font-size: 0.85rem;
            }



            .captcha-container {
                padding: 8px;
                gap: 6px;
                margin-bottom: 10px;
                border-radius: 8px;
            }

            .captcha-container canvas {
                width: 140px !important;
                height: 40px !important;
                margin: 4px 0;
            }
            
            .mobile-captcha .captcha-canvas {
                width: 140px !important;
                height: 40px !important;
                margin: 4px 0;
            }

            .captcha-input {
                max-width: 160px;
                font-size: 0.8rem;
                padding: 8px 10px;
            }

            .input-help {
                font-size: 0.7rem;
                margin-top: 5px;
                padding: 5px 8px;
            }

            .otp-timer {
                padding: 10px;
                margin: 14px 0;
            }

            .timer {
                font-size: 0.9rem;
                padding: 5px 8px;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
                height: auto;
                min-height: 150px;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                height: auto;
                min-height: 150px;
            }
        }

        .main-container {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 80px - 120px); /* Subtract header height and footer height with spacing */
            margin-top: 80px; /* Increased spacing from header */
            margin-bottom: 120px; /* Reduced spacing to footer */
            animation: slideInUp 0.8s ease-out;
            /* Hardware acceleration for smooth rendering */
            transform: translateZ(0);
            backface-visibility: hidden;
            will-change: transform;
        }

        /* Desktop Modern Panel Design */
        @media (min-width: 1024px) {
            .main-container {
                justify-content: center;
                padding: 0 2rem;
                margin-top: 80px;
                margin-bottom: 120px;
                min-height: calc(100vh - 80px - 120px);
            }

            h1 {
                font-size: 2.2rem;
                margin-bottom: 2rem;
            }

            .auth-tabs {
                gap: 12px;
                margin-bottom: 2rem;
                padding: 12px;
            }

            .auth-tab {
                padding: 18px 20px;
                font-size: 1.1rem;
                border-radius: 14px;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-group label {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
            }

            input {
                padding: 18px 18px 18px 50px;
                font-size: 1.1rem;
                border-radius: 12px;
            }

            .input-group i {
                font-size: 1.3rem;
                left: 22px;
            }

            .auth-btn {
                padding: 18px;
                font-size: 1.2rem;
                margin-top: 2rem;
                border-radius: 12px;
            }

            .social-btn {
                padding: 16px;
                font-size: 1.1rem;
                margin-top: 1rem;
            }

            .auth-container {
                animation: slideInFromSides 1.2s ease-out forwards;
                max-width: 850px;
                min-height: 650px;
                position: relative;
                overflow: hidden;
                padding: 3rem 2.5rem;
            }

            .auth-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                animation: slideInFromLeft 1.5s ease-out 0.3s forwards;
            }

            .auth-container::after {
                content: '';
                position: absolute;
                top: 0;
                right: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                animation: slideInFromRight 1.5s ease-out 0.3s forwards;
            }

                    @keyframes slideInFromSides {
            0% {
                    opacity: 0;
                transform: scale(0.8) translate3d(-50px, 0, 0);
            }
            50% {
                opacity: 0.7;
                transform: scale(0.95) translate3d(25px, 0, 0);
            }
            100% {
                opacity: 1;
                transform: scale(1) translate3d(0, 0, 0);
            }
        }

            @keyframes slideInFromLeft {
                to {
                    left: 100%;
                }
            }

            @keyframes slideInFromRight {
                to {
                    right: 100%;
                }
            }
        }

        /* Large Desktop - Enhanced Panel */
        @media (min-width: 1400px) {
            .main-container {
                padding: 0 1rem;
                margin-top: 100px;
                margin-bottom: 150px;
                min-height: calc(100vh - 100px - 150px);
                max-width: 1600px;
            }

            .auth-container {
                max-width: 900px;
                min-height: 700px;
                animation: slideInFromSidesEnhanced 1.4s ease-out forwards;
                padding: 4rem 3.5rem;
            }

            h1 {
                font-size: 2.5rem;
                margin-bottom: 2.5rem;
            }

            .auth-tabs {
                gap: 15px;
                margin-bottom: 2.5rem;
                padding: 15px;
            }

            .auth-tab {
                padding: 20px 25px;
                font-size: 1.2rem;
                border-radius: 16px;
            }

            .form-group {
                margin-bottom: 2rem;
            }

            .form-group label {
                font-size: 1.2rem;
                margin-bottom: 1rem;
            }

            input {
                padding: 20px 20px 20px 55px;
                font-size: 1.2rem;
                border-radius: 14px;
            }

            .input-group i {
                font-size: 1.4rem;
                left: 25px;
            }

            .auth-btn {
                padding: 20px;
                font-size: 1.3rem;
                margin-top: 2.5rem;
                border-radius: 14px;
            }

            .social-btn {
                padding: 18px;
                font-size: 1.2rem;
                margin-top: 1.5rem;
            }

            @keyframes slideInFromSidesEnhanced {
                0% {
                    opacity: 0;
                    transform: scale(0.7) translate3d(-80px, 0, 0);
                }
                60% {
                    opacity: 0.8;
                    transform: scale(0.9) translate3d(40px, 0, 0);
                }
                100% {
                    opacity: 1;
                    transform: scale(1) translate3d(0, 0, 0);
                }
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 50px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius-lg);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.2),
                0 8px 25px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            padding: 2.5rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transform: perspective(1000px) rotateX(0deg) translateZ(0);
            transition: var(--transition);
            width: 100%;
            max-width: 650px;
            min-height: 500px;
            color: var(--text-primary);
            /* Hardware acceleration for smooth rendering */
            backface-visibility: hidden;
            will-change: transform;
        }

        /* Enhanced glass effect for desktop */
        @media (min-width: 1024px) {
            .auth-container {
                background: rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(30px);
                border: 1px solid rgba(255, 255, 255, 0.4);
                box-shadow: 
                    0 25px 80px rgba(0, 0, 0, 0.25),
                    0 8px 32px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
                padding: 3rem 2.5rem;
                max-width: 750px;
            }
        }

        /* Language-specific text alignment */
        body.lang-fa .auth-container {
            text-align: right;
        }

        body.lang-en .auth-container {
            text-align: left;
        }

        .auth-container:hover {
            transform: perspective(1000px) rotateX(2deg) scale(1.02);
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.25);
            border-color: var(--primary-color);
        }

        /* Enhanced hover effect for desktop */
        @media (min-width: 1024px) {
            .auth-container:hover {
                transform: perspective(1000px) rotateX(3deg) scale(1.03);
                box-shadow: 
                    0 35px 120px rgba(0, 0, 0, 0.3),
                    0 12px 40px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
                border-color: var(--primary-color);
            }
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            background-size: 200% 100%;
            animation: gradientMove 3s ease infinite;
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }



        @keyframes headerLogoPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(79, 70, 229, 0.25);
            }
            50% { 
                transform: scale(1.08);
                box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
            }
        }

        @keyframes headerLogoShine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        h1 {
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            text-align: center;
        }





        /* Language and Theme Controls */
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        .control-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            background: var(--primary-color);
            color: white;
        }

        .language-selector {
            position: relative;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
            min-width: 120px;
            z-index: 100;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border-color);
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option:hover {
            background: var(--bg-secondary);
        }

        .language-option.active {
            background: var(--primary-color);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
            position: relative;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid transparent;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .form-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            padding: 2px;
            background: linear-gradient(45deg, 
                #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff, #5f27cd);
            background-size: 400% 400%;
            animation: rainbowBorder 3s ease infinite;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .form-group:hover::before {
            opacity: 0.8;
            animation: rainbowBorder 1.5s ease infinite;
        }

        @keyframes rainbowBorder {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: bold;
            font-size: 0.9rem;
        }

        label i {
            font-size: 1rem;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .input-group {
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            transition: var(--transition);
        }

        input {
            width: 100%;
            padding: 18px 18px 18px 50px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
        }

        input:hover {
            border-color: var(--accent-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            background: var(--bg-primary);
            transform: translateY(-2px);
        }

        /* Placeholder styling */
        input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
            transition: color 0.3s ease;
        }

        /* Placeholder colors for different themes */
        [data-theme="light"] input::placeholder {
            color: #6b7280;
            opacity: 0.8;
        }

        [data-theme="dark"] input::placeholder {
            color: #9ca3af;
            opacity: 0.7;
        }

        input:focus::placeholder {
            color: var(--primary-color);
            opacity: 0.5;
        }

        input:focus + i {
            color: var(--primary-color);
            transform: translateY(-50%) scale(1.1);
        }

        /* Override any conflicting input styles for captcha */
        .captcha-input.correct,
        .captcha-input.correct:focus,
        .captcha-input.correct:hover,
        .captcha-input.correct:active {
            color: var(--success-color) !important;
            border-color: var(--success-color) !important;
            background-color: rgba(16, 185, 129, 0.05) !important;
        }

        .captcha-input.error,
        .captcha-input.error:focus,
        .captcha-input.error:hover,
        .captcha-input.error:active {
            color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
            background-color: rgba(239, 68, 68, 0.05) !important;
        }

        /* Additional specificity for all captcha inputs */
        #captcha-input.correct,
        #register-captcha-input.correct,
        #recovery-captcha-input.correct,
        #mobile-captcha-input.correct {
            color: var(--success-color) !important;
            border-color: var(--success-color) !important;
            background-color: rgba(16, 185, 129, 0.05) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
        }

        #captcha-input.error,
        #register-captcha-input.error,
        #recovery-captcha-input.error,
        #mobile-captcha-input.error {
            color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
            background-color: rgba(239, 68, 68, 0.05) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        /* Focus states for all captcha inputs */
        #captcha-input:focus.correct,
        #register-captcha-input:focus.correct,
        #recovery-captcha-input:focus.correct,
        #mobile-captcha-input:focus.correct {
            color: var(--success-color) !important;
            border-color: var(--success-color) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2) !important;
        }

        #captcha-input:focus.error,
        #register-captcha-input:focus.error,
        #recovery-captcha-input:focus.error,
        #mobile-captcha-input:focus.error {
            color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
        }

        .input-group {
            position: relative;
            margin-bottom: 5px;
        }

        .input-group i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            transition: var(--transition);
            font-size: 1.1rem;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.1);
            color: #666;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .password-toggle::before,
        .password-toggle::after {
            display: none !important;
            content: none !important;
        }

        .password-toggle * {
            display: block;
        }

        .password-toggle i {
            display: block !important;
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        /* Ensure no square appears in any state */
        .password-toggle *,
        .password-toggle *::before,
        .password-toggle *::after {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        /* Override any inherited styles that might create squares */
        .input-group .password-toggle {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        /* Remove any background or border that might create a square */
        .password-toggle {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .password-toggle:hover {
            background: rgba(59, 130, 246, 0.1) !important;
            border: 1px solid rgba(59, 130, 246, 0.2) !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .password-toggle:focus {
            background: rgba(59, 130, 246, 0.1) !important;
            border: 1px solid rgba(59, 130, 246, 0.2) !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .password-toggle:active {
            background: rgba(59, 130, 246, 0.15) !important;
            border: 1px solid rgba(59, 130, 246, 0.3) !important;
            box-shadow: none !important;
            outline: none !important;
        }

        /* Remove any pseudo-elements that might create squares */
        .password-toggle::before,
        .password-toggle::after,
        .password-toggle:hover::before,
        .password-toggle:hover::after,
        .password-toggle:focus::before,
        .password-toggle:focus::after,
        .password-toggle:active::before,
        .password-toggle:active::after {
            display: none !important;
            content: none !important;
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            width: 0 !important;
            height: 0 !important;
            opacity: 0 !important;
        }

        /* RTL support for password toggle */
        [dir="rtl"] .password-toggle {
            right: auto;
            left: 15px;
        }



        .password-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* Adjust input padding for password fields */
        .input-group:has(.password-toggle) input {
            padding-left: 15px;
            padding-right: 50px;
        }

        /* Adjust input padding for all fields */
        .input-group input {
            padding-left: 15px;
            padding-right: 15px;
        }

        .password-strength {
            margin-top: 5px;
            height: 4px;
            border-radius: 2px;
            background: #e1e5e9;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: var(--transition);
            border-radius: 2px;
        }

        .strength-weak { background: var(--danger-color); }
        .strength-medium { background: var(--warning-color); }
        .strength-strong { background: var(--success-color); }

        .captcha-container {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .captcha-canvas {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            margin: 15px 0;
            cursor: pointer;
            align-self: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .captcha-canvas:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .captcha-input {
            padding: 16px 20px !important;
            width: 100%;
            max-width: 320px;
            margin: 0 auto;
            text-align: center;
            letter-spacing: 3px;
            font-weight: 700;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            color: var(--text-primary) !important;
            border-radius: 14px;
            min-height: 50px;
            line-height: 1.2;
        }

        /* Captcha input success state - green when correct */
        .captcha-input.correct {
            border-color: var(--success-color) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
            color: var(--success-color) !important;
            font-weight: 700 !important;
            background-color: rgba(16, 185, 129, 0.05) !important;
        }

        .captcha-input.correct::placeholder {
            color: var(--success-color) !important;
            opacity: 0.7 !important;
        }

        /* Captcha input error state */
        .captcha-input.error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
            color: var(--danger-color) !important;
            font-weight: 700 !important;
            background-color: rgba(239, 68, 68, 0.05) !important;
        }

        .captcha-input.error::placeholder {
            color: var(--danger-color) !important;
            opacity: 0.7 !important;
        }

        /* Captcha input focus states */
        .captcha-input:focus.correct {
            border-color: var(--success-color) !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2) !important;
            color: var(--success-color) !important;
        }

        .captcha-input:focus.error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
            color: var(--danger-color) !important;
        }

        /* Enhanced Captcha input success animation */
        .captcha-input.correct {
            animation: captchaSuccess 0.6s ease-out;
        }

        @keyframes captchaSuccess {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }
            25% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.2);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }
        }

        @keyframes captchaCorrect {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }
            25% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.2);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            }
        }

        /* Enhanced Captcha input error shake animation */
        .captcha-input.error {
            animation: captchaError 0.6s ease-out;
        }

        @keyframes captchaError {
            0%, 100% { 
                transform: translateX(0) scale(1);
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            }
            15% { 
                transform: translateX(-8px) scale(1.02);
                box-shadow: 0 0 0 6px rgba(239, 68, 68, 0.2);
            }
            30% { 
                transform: translateX(8px) scale(1.02);
                box-shadow: 0 0 0 6px rgba(239, 68, 68, 0.2);
            }
            45% { 
                transform: translateX(-4px) scale(1.01);
                box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.15);
            }
            60% { 
                transform: translateX(4px) scale(1.01);
                box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.15);
            }
            75% { 
                transform: translateX(-2px) scale(1);
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            }
            90% { 
                transform: translateX(2px) scale(1);
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            }
        }

        /* Ensure text color overrides work in all states */
        .captcha-input.correct,
        .captcha-input.correct:focus,
        .captcha-input.correct:hover {
            color: var(--success-color) !important;
            border-color: var(--success-color) !important;
        }

        .captcha-input.error,
        .captcha-input.error:focus,
        .captcha-input.error:hover {
            color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
        }

        /* Higher specificity to ensure text color changes */
        input.captcha-input.correct,
        input.captcha-input.correct:focus,
        input.captcha-input.correct:hover,
        input.captcha-input.correct:active {
            color: var(--success-color) !important;
            border-color: var(--success-color) !important;
            background-color: rgba(16, 185, 129, 0.05) !important;
        }

        input.captcha-input.error,
        input.captcha-input.error:focus,
        input.captcha-input.error:hover,
        input.captcha-input.error:active {
            color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
            background-color: rgba(239, 68, 68, 0.05) !important;
        }

        /* Force text color for all input states */
        input[type="text"].captcha-input.correct {
            color: var(--success-color) !important;
        }

        input[type="text"].captcha-input.error {
            color: var(--danger-color) !important;
        }

        .captcha-input i {
            left: 15px;
        }

        /* Improve captcha input group styling */
        .captcha-container .input-group {
            margin-top: 10px;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Ensure proper spacing between captcha elements */
        .captcha-container label {
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .captcha-container canvas {
            margin: 10px 0;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .captcha-container canvas:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            transform: scale(1.02);
        }

        .captcha-container canvas:active {
            transform: scale(0.98);
        }

        .auth-btn {
            width: 100%;
            padding: 20px 28px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            background-size: 200% 200%;
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            animation: buttonGradient 6s ease infinite;
            box-shadow: 
                0 10px 30px rgba(37, 99, 235, 0.3),
                0 5px 15px rgba(37, 99, 235, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            min-height: 60px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Light theme button gradient - Modern Colors */
        [data-theme="light"] .auth-btn {
            background: linear-gradient(135deg, #ec4899, #22c55e, #3b82f6);
            background-size: 200% 200%;
            animation: buttonGradientLight 8s ease infinite;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }

        /* Dark theme button gradient - Contrast Colors */
        [data-theme="dark"] .auth-btn {
            background: linear-gradient(135deg, #6366f1, #06b6d4, #8b5cf6);
            background-size: 200% 200%;
            animation: buttonGradientDark 8s ease infinite;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .auth-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        /* Light theme hover effects */
        [data-theme="light"] .auth-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(236, 72, 153, 0.4),
                0 10px 20px rgba(34, 197, 94, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #f472b6, #4ade80, #60a5fa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Dark theme hover effects */
        [data-theme="dark"] .auth-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(99, 102, 241, 0.5),
                0 10px 20px rgba(6, 182, 212, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #818cf8, #22d3ee, #a78bfa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .auth-btn:hover::before {
            left: 100%;
        }

        .auth-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            animation: none;
        }

        @keyframes buttonGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes buttonGradientLight {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 100% 50%; }
            66% { background-position: 50% 100%; }
        }

        @keyframes buttonGradientDark {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 100% 50%; }
            66% { background-position: 50% 100%; }
        }

        .auth-btn .spinner {
            display: none;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Glass Design Notifications */
        .message {
            padding: 16px 20px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 20px;
            display: none;
            font-weight: 600;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            border: 1px solid;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInDown 0.4s ease-out;
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, currentColor, transparent);
            opacity: 0.6;
        }

        .message::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .message:hover::after {
            left: 100%;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Error Message - Glass Red */
        .error-message {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.15);
        }

        .error-message::before {
            background: linear-gradient(90deg, #dc2626, #ef4444, #dc2626);
        }

        /* Success Message - Glass Green */
        .success-message {
            background: rgba(16, 185, 129, 0.15);
            color: #059669;
            border-color: rgba(16, 185, 129, 0.4);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
        }

        .success-message::before {
            background: linear-gradient(90deg, #059669, #10b981, #059669);
        }
        /* Warning Message - Glass Orange */
        .warning-message {
            background: rgba(245, 158, 11, 0.15);
            color: #d97706;
            border-color: rgba(245, 158, 11, 0.4);
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.15);
        }

        .warning-message::before {
            background: linear-gradient(90deg, #d97706, #f59e0b, #d97706);
        }

        /* Info Message - Glass Blue */
        .info-message {
            background: rgba(14, 165, 233, 0.15);
            color: #0284c7;
            border-color: rgba(14, 165, 233, 0.4);
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.15);
        }

        .info-message::before {
            background: linear-gradient(90deg, #0284c7, #0ea5e9, #0284c7);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 35px;
            background: linear-gradient(135deg, rgba(248, 249, 250, 0.9), rgba(102, 126, 234, 0.05));
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 10px;
            border: 1px solid rgba(102, 126, 234, 0.15);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.1),
                0 4px 20px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .auth-tabs::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            opacity: 0.3;
        }

        .auth-tab {
            flex: 1;
            padding: 16px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
            z-index: 1;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
            border: 2px solid transparent;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 55px;
        }

        .auth-tab i {
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .auth-tab span {
            font-weight: 600;
            transition: all 0.3s ease;
        }

        /* Light theme auth tabs */
        [data-theme="light"] .auth-tab {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            color: #64748b;
            border-color: rgba(59, 130, 246, 0.1);
        }

        /* Dark theme auth tabs */
        [data-theme="dark"] .auth-tab {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: #94a3b8;
            border-color: rgba(99, 102, 241, 0.2);
        }

        .auth-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }

        .auth-tab:hover {
            transform: translateY(-3px) scale(1.05);
            color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        }

        /* Light theme hover */
        [data-theme="light"] .auth-tab:hover {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1d4ed8;
            border-color: #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        /* Dark theme hover */
        [data-theme="dark"] .auth-tab:hover {
            background: linear-gradient(135deg, #3730a3, #4338ca);
            color: #e0e7ff;
            border-color: #6366f1;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .auth-tab:hover::before {
            left: 100%;
        }

        .auth-tab:hover::after {
            width: 80%;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 12px 35px rgba(102, 126, 234, 0.4),
                0 6px 20px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .auth-tab.active i {
            transform: scale(1.1);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .auth-tab.active span {
            transform: scale(1.05);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Light theme active */
        [data-theme="light"] .auth-tab.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-color: #1d4ed8;
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
        }

        /* Dark theme active */
        [data-theme="dark"] .auth-tab.active {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
        }

        .auth-tab.active::after {
            width: 90%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--primary-color));
        }

        .auth-content {
            display: none;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-content.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .social-login {
            margin-top: 30px;
            text-align: center;
        }

        .divider {
            position: relative;
            text-align: center;
            margin: 25px 0;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #ddd, transparent);
        }

        .divider span {
            background: rgba(255, 255, 255, 0.95);
            padding: 0 15px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .social-btn {
            width: 100%;
            padding: 15px 20px;
            margin: 12px 0;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .social-btn-content {
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2;
            position: relative;
        }

        .social-btn-ripple {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .social-btn:hover .social-btn-ripple {
            width: 300px;
            height: 300px;
        }

        /* Light theme Google button */
        [data-theme="light"] .social-btn.google {
            background: linear-gradient(135deg, #ec4899, #22c55e, #3b82f6);
            background-size: 200% 200%;
            color: white;
            animation: buttonGradientLight 8s ease infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }

        /* Dark theme Google button */
        [data-theme="dark"] .social-btn.google {
            background: linear-gradient(135deg, #6366f1, #06b6d4, #8b5cf6);
            background-size: 200% 200%;
            color: white;
            animation: buttonGradientDark 8s ease infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        /* Light theme mobile button */
        [data-theme="light"] .social-btn.mobile {
            background: linear-gradient(135deg, #ec4899, #22c55e, #3b82f6);
            background-size: 200% 200%;
            color: white;
            animation: buttonGradientLight 8s ease infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }

        /* Dark theme mobile button */
        [data-theme="dark"] .social-btn.mobile {
            background: linear-gradient(135deg, #6366f1, #06b6d4, #8b5cf6);
            background-size: 200% 200%;
            color: white;
            animation: buttonGradientDark 8s ease infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        @keyframes googleGradient {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 100% 50%; }
            66% { background-position: 50% 100%; }
        }



        @keyframes mobileGradient {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 100% 50%; }
            66% { background-position: 50% 100%; }
        }

        /* Light theme Google button hover - Exact same as auth-btn */
        [data-theme="light"] .social-btn.google:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(236, 72, 153, 0.4),
                0 10px 20px rgba(34, 197, 94, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #f472b6, #4ade80, #60a5fa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        [data-theme="light"] .social-btn.google:hover::before {
            left: 100%;
        }

        /* Dark theme Google button hover - Exact same as auth-btn */
        [data-theme="dark"] .social-btn.google:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(99, 102, 241, 0.5),
                0 10px 20px rgba(6, 182, 212, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #818cf8, #22d3ee, #a78bfa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] .social-btn.google:hover::before {
            left: 100%;
        }

        /* Light theme mobile button hover - Exact same as auth-btn */
        [data-theme="light"] .social-btn.mobile:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(236, 72, 153, 0.4),
                0 10px 20px rgba(34, 197, 94, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #f472b6, #4ade80, #60a5fa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        [data-theme="light"] .social-btn.mobile:hover::before {
            left: 100%;
        }

        /* Dark theme mobile button hover - Exact same as auth-btn */
        [data-theme="dark"] .social-btn.mobile:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(99, 102, 241, 0.5),
                0 10px 20px rgba(6, 182, 212, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #818cf8, #22d3ee, #a78bfa);
            border-color: rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] .social-btn.mobile:hover::before {
            left: 100%;
        }

        /* General social button hover for other buttons */
        .social-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }

        .social-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .social-btn i {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .social-btn:hover i {
            transform: scale(1.2);
        }

        .forgot-password {
            text-align: left;
            margin-top: 15px;
        }

        .forgot-password a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            padding: 6px 12px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid transparent;
        }

        .forgot-password a:hover {
            color: var(--accent-color);
            text-decoration: none;
            transform: translateY(-1px);
            background: rgba(59, 130, 246, 0.1);
        }

        .forgot-password a:active {
            transform: translateY(0px);
        }

        /* Light theme specific colors for links - Black/White Rainbow */
        [data-theme="light"] .forgot-password a {
            color: #1e293b;
            background: rgba(30, 41, 59, 0.1);
            border: 1px solid rgba(30, 41, 59, 0.2);
            animation: blackWhiteRainbowText 4s ease-in-out infinite, blackWhiteRainbowBg 5s ease-in-out infinite;
        }

        [data-theme="light"] .forgot-password a:hover {
            color: #0f172a;
            background: rgba(30, 41, 59, 0.15);
            border-color: rgba(30, 41, 59, 0.3);
            box-shadow: 0 2px 8px rgba(30, 41, 59, 0.2);
            transform: translateY(-1px);
            animation: blackWhiteRainbowText 2s ease-in-out infinite, blackWhiteRainbowBg 2.5s ease-in-out infinite;
        }

        [data-theme="light"] .forgot-password a:active {
            color: #020617;
            background: rgba(30, 41, 59, 0.2);
            transform: translateY(0);
        }

        /* Dark theme specific colors for links - White/Black Rainbow */
        [data-theme="dark"] .forgot-password a {
            color: #f1f5f9;
            background: rgba(241, 245, 249, 0.1);
            border: 1px solid rgba(241, 245, 249, 0.2);
            animation: whiteBlackRainbowText 3s ease-in-out infinite, whiteBlackRainbowBg 4s ease-in-out infinite;
        }

        [data-theme="dark"] .forgot-password a:hover {
            color: #ffffff;
            background: rgba(241, 245, 249, 0.15);
            border-color: rgba(241, 245, 249, 0.3);
            box-shadow: 0 2px 8px rgba(241, 245, 249, 0.2);
            transform: translateY(-1px);
            animation: whiteBlackRainbowText 1.5s ease-in-out infinite, whiteBlackRainbowBg 2s ease-in-out infinite;
        }

        [data-theme="dark"] .forgot-password a:active {
            color: #e2e8f0;
            background: rgba(241, 245, 249, 0.2);
            transform: translateY(0);
        }

        /* White/Black rainbow animation for dark theme */
        @keyframes whiteBlackRainbowText {
            0% { 
                color: #f1f5f9; 
                text-shadow: 0 0 5px rgba(241, 245, 249, 0.5);
            }
            16.66% { 
                color: #e2e8f0; 
                text-shadow: 0 0 5px rgba(226, 232, 240, 0.5);
            }
            33.33% { 
                color: #cbd5e1; 
                text-shadow: 0 0 5px rgba(203, 213, 225, 0.5);
            }
            50% { 
                color: #94a3b8; 
                text-shadow: 0 0 5px rgba(148, 163, 184, 0.5);
            }
            66.66% { 
                color: #64748b; 
                text-shadow: 0 0 5px rgba(100, 116, 139, 0.5);
            }
            83.33% { 
                color: #f1f5f9; 
                text-shadow: 0 0 5px rgba(241, 245, 249, 0.5);
            }
            100% { 
                color: #f1f5f9; 
                text-shadow: 0 0 5px rgba(241, 245, 249, 0.5);
            }
        }

        @keyframes whiteBlackRainbowBg {
            0% { 
                background: rgba(241, 245, 249, 0.1);
                border-color: rgba(241, 245, 249, 0.2);
            }
            16.66% { 
                background: rgba(226, 232, 240, 0.1);
                border-color: rgba(226, 232, 240, 0.2);
            }
            33.33% { 
                background: rgba(203, 213, 225, 0.1);
                border-color: rgba(203, 213, 225, 0.2);
            }
            50% { 
                background: rgba(148, 163, 184, 0.1);
                border-color: rgba(148, 163, 184, 0.2);
            }
            66.66% { 
                background: rgba(100, 116, 139, 0.1);
                border-color: rgba(100, 116, 139, 0.2);
            }
            83.33% { 
                background: rgba(241, 245, 249, 0.1);
                border-color: rgba(241, 245, 249, 0.2);
            }
            100% { 
                background: rgba(241, 245, 249, 0.1);
                border-color: rgba(241, 245, 249, 0.2);
            }
        }

        /* Black/White rainbow animation for light theme */
        @keyframes blackWhiteRainbowText {
            0% { 
                color: #1e293b; 
                text-shadow: 0 0 5px rgba(30, 41, 59, 0.3);
            }
            16.66% { 
                color: #475569; 
                text-shadow: 0 0 5px rgba(71, 85, 105, 0.3);
            }
            33.33% { 
                color: #64748b; 
                text-shadow: 0 0 5px rgba(100, 116, 139, 0.3);
            }
            50% { 
                color: #334155; 
                text-shadow: 0 0 5px rgba(51, 65, 85, 0.3);
            }
            66.66% { 
                color: #0f172a; 
                text-shadow: 0 0 5px rgba(15, 23, 42, 0.3);
            }
            83.33% { 
                color: #1e293b; 
                text-shadow: 0 0 5px rgba(30, 41, 59, 0.3);
            }
            100% { 
                color: #1e293b; 
                text-shadow: 0 0 5px rgba(30, 41, 59, 0.3);
            }
        }

        @keyframes blackWhiteRainbowBg {
            0% { 
                background: rgba(30, 41, 59, 0.1);
                border-color: rgba(30, 41, 59, 0.2);
            }
            16.66% { 
                background: rgba(71, 85, 105, 0.1);
                border-color: rgba(71, 85, 105, 0.2);
            }
            33.33% { 
                background: rgba(100, 116, 139, 0.1);
                border-color: rgba(100, 116, 139, 0.2);
            }
            50% { 
                background: rgba(51, 65, 85, 0.1);
                border-color: rgba(51, 65, 85, 0.2);
            }
            66.66% { 
                background: rgba(15, 23, 42, 0.1);
                border-color: rgba(15, 23, 42, 0.2);
            }
            83.33% { 
                background: rgba(30, 41, 59, 0.1);
                border-color: rgba(30, 41, 59, 0.2);
            }
            100% { 
                background: rgba(30, 41, 59, 0.1);
                border-color: rgba(30, 41, 59, 0.2);
            }
        }

        /* Dark theme captcha input overrides */
        [data-theme="dark"] .captcha-input.correct {
            color: #10b981 !important;
            border-color: #10b981 !important;
            background-color: rgba(16, 185, 129, 0.1) !important;
        }

        [data-theme="dark"] .captcha-input.error {
            color: #ef4444 !important;
            border-color: #ef4444 !important;
            background-color: rgba(239, 68, 68, 0.1) !important;
        }

        [data-theme="dark"] #captcha-input.correct,
        [data-theme="dark"] #register-captcha-input.correct,
        [data-theme="dark"] #recovery-captcha-input.correct,
        [data-theme="dark"] #mobile-captcha-input.correct {
            color: #10b981 !important;
            border-color: #10b981 !important;
            background-color: rgba(16, 185, 129, 0.1) !important;
        }

        [data-theme="dark"] #captcha-input.error,
        [data-theme="dark"] #register-captcha-input.error,
        [data-theme="dark"] #recovery-captcha-input.error,
        [data-theme="dark"] #mobile-captcha-input.error {
            color: #ef4444 !important;
            border-color: #ef4444 !important;
            background-color: rgba(239, 68, 68, 0.1) !important;
        }



        .two-factor-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
        }

        .qr-code {
            text-align: center;
            margin: 15px 0;
        }

        .qr-code canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .otp-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .otp-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.2rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
        }

        .otp-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 70px; /* Reduced padding for mobile */
            }
            
            .main-container {
                margin: 5px;
                max-width: 100%;
                margin-top: 70px; /* Reduced margin for mobile */
                margin-bottom: 150px; /* Spacing to footer on mobile */
                min-height: calc(100vh - 70px - 150px); /* Adjusted for mobile header and footer */
            }
            
            .auth-container {
                padding: 20px 15px;
                margin: 2px;
            }
            
            .logo {
                width: 45px;
                height: 45px;
            }
            
            h1 {
                font-size: 1.1rem;
                text-align: center;
            }
            

            

            
            .auth-tabs {
                flex-direction: column;
                gap: 4px;
                margin-bottom: 25px;
                border-radius: 12px;
                padding: 6px;
            }
            
            .auth-tab {
                padding: 12px 8px;
                font-size: 0.9rem;
                border-radius: 8px;
                margin: 2px 0;
            }

            /* Mobile theme-specific auth tabs */
            [data-theme="light"] .auth-tab {
                background: linear-gradient(135deg, #f8fafc, #f1f5f9);
                color: #64748b;
            }

            [data-theme="dark"] .auth-tab {
                background: linear-gradient(135deg, #1e293b, #334155);
                color: #94a3b8;
            }

            .auth-tab:hover {
                transform: translateY(-1px) scale(1.01);
            }

            .auth-tab.active {
                transform: translateY(-2px) scale(1.02);
            }

            .controls {
                top: 6px;
                right: 6px;
            }

            .control-btn {
                width: 26px;
                height: 26px;
                font-size: 0.75rem;
            }

            input {
                padding: 12px 12px 12px 35px;
                font-size: 0.85rem;
            }

            .auth-btn {
                padding: 14px;
                font-size: 0.95rem;
                margin-top: 12px;
            }

            /* Mobile forgot password improvements */
            .forgot-password {
                margin-top: 12px;
                text-align: center;
            }

            .forgot-password a {
                font-size: 0.85rem;
                padding: 8px 12px;
                border-radius: 6px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 60px; /* Further reduced padding for small mobile */
                padding-bottom: 100px; /* Reduced padding for footer on small mobile */
                /* Optimize scrolling for small mobile */
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            .main-container {
                margin: 2px;
                margin-top: 60px; /* Reduced margin for small mobile */
                margin-bottom: 100px; /* Reduced spacing to footer on small mobile */
                min-height: calc(100vh - 60px - 100px); /* Adjusted for small mobile header and footer */
            }
            
            .auth-container {
                padding: 18px 12px;
                border-radius: 8px;
                /* Disable heavy animations on small mobile for better performance */
                transform: none !important;
                animation: none !important;
            }

            .auth-container:hover {
                transform: none !important;
            }

            /* Disable complex hover effects on small mobile */
            .auth-tab:hover {
                transform: none !important;
            }

            .auth-tab.active {
                transform: none !important;
            }
            
            .logo {
                width: 35px;
                height: 35px;
            }
            
            h1 {
                font-size: 1rem;
                text-align: center;
            }
            

            

            
            input {
                padding: 8px 8px 8px 30px;
                font-size: 0.8rem;
            }
            
            .auth-btn {
                padding: 8px;
                font-size: 0.85rem;
                margin-top: 10px;
            }
            
            .otp-inputs {
                gap: 2px;
            }
            
            .otp-input {
                width: 25px;
                height: 25px;
                font-size: 0.7rem;
            }
            
            .auth-tabs {
                flex-direction: column;
                gap: 3px;
                margin-bottom: 20px;
                border-radius: 10px;
                padding: 4px;
            }
            
            .auth-tab {
                padding: 10px 6px;
                font-size: 0.8rem;
                border-radius: 6px;
                margin: 1px 0;
            }

            .auth-tab:hover {
                transform: translateY(-1px) scale(1.01);
            }

            .auth-tab.active {
                transform: translateY(-1px) scale(1.02);
            }
            
            .particle {
                display: block !important;
                /* Optimize for small mobile */
                filter: blur(0.5px);
                animation-duration: 8s !important;
            }

            .controls {
                top: 3px;
                right: 3px;
                gap: 3px;
            }

            .control-btn {
                width: 22px;
                height: 22px;
                font-size: 0.7rem;
            }

            .auth-tabs {
                margin-bottom: 20px;
            }

            .auth-tab {
                padding: 4px;
                font-size: 0.8rem;
            }
        }
        @media (max-width: 360px) {
            body {
                padding-top: 55px; /* Minimal padding for very small mobile */
            }
            
            .main-container {
                margin-top: 55px; /* Minimal margin for very small mobile */
                min-height: calc(100vh - 55px); /* Adjusted for very small mobile header */
            }
            
            .auth-container {
                padding: 10px 8px;
            }
            
            .logo {
                width: 30px;
                height: 30px;
            }
            
            h1 {
                font-size: 0.9rem;
            }



            .controls {
                top: 2px;
                right: 2px;
            }

            .control-btn {
                width: 20px;
                height: 20px;
                font-size: 0.65rem;
            }

            input {
                padding: 6px 6px 6px 25px;
                font-size: 0.75rem;
            }

            .auth-btn {
                padding: 6px;
                font-size: 0.8rem;
                margin-top: 8px;
            }

            /* Small mobile forgot password improvements */
            .forgot-password {
                margin-top: 10px;
            }

            .forgot-password a {
                font-size: 0.8rem;
                padding: 6px 10px;
                border-radius: 6px;
            }

            .auth-tabs {
                margin-bottom: 15px;
            }

            .auth-tab {
                padding: 3px;
                font-size: 0.75rem;
            }

            .password-toggle {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
                right: 10px;
                padding: 5px;
            }

            [dir="rtl"] .password-toggle {
                right: auto;
                left: 10px;
            }
        }

        /* Loading animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Smart Header -->
    <header class="smart-header notranslate" id="smartHeader" role="banner" aria-label="هدر اصلی">
        <div class="smart-header-content">
            <div class="header-logo">
                <img src="/static/images/logo.png" alt="لوگو سیستم دوربین هوشمند" aria-label="لوگوی سیستم">
                <span class="header-logo-text" data-i18n="system_title" role="heading" aria-level="1">Smart Control</span>
            </div>
            <div class="header-controls" role="toolbar" aria-label="کنترل‌های هدر">
                <button class="header-btn" id="homeBtn" title="صفحه اصلی" aria-label="برگشت به صفحه اصلی" role="button">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <span data-i18n="home">صفحه اصلی</span>
                </button>
                <button class="header-btn" id="themeBtn" title="تغییر تم" aria-label="تغییر تم" role="button">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                    <span data-i18n="theme">تم</span>
                </button>
                <button class="header-btn" id="langBtn" title="تغییر زبان" aria-label="تغییر زبان" role="button">
                    <i class="fas fa-globe" aria-hidden="true"></i>
                    <span data-i18n="language">زبان</span>
                </button>
            </div>
        </div>
    </header>



    <!-- Animated background particles -->
    

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="main-container">
        <div class="auth-container">

            
            <!-- Auth tabs -->
            <div class="auth-tabs" role="tablist" aria-label="انتخاب نوع عملیات">
                <div class="auth-tab active" onclick="switchTab('login')" data-i18n="login" role="tab" aria-selected="true" aria-controls="login-content" tabindex="0"
                     title="ورود به سیستم با نام کاربری و رمز عبور" 
                     aria-label="ورود به سیستم">
                    <i class="fas fa-user"></i>
                    <span>ورود</span>
                </div>
                <div class="auth-tab" onclick="switchTab('mobile')" data-i18n="mobileLogin" role="tab" aria-selected="false" aria-controls="mobile-content" tabindex="0"
                     title="ورود با شماره موبایل و کد تأیید" 
                     aria-label="ورود با موبایل">
                    <i class="fas fa-mobile-alt"></i>
                    <span>ورود با موبایل</span>
                </div>
                <div class="auth-tab" onclick="switchTab('register')" data-i18n="register" role="tab" aria-selected="false" aria-controls="register-content" tabindex="0"
                     title="ایجاد حساب کاربری جدید" 
                     aria-label="ثبت‌نام">
                    <i class="fas fa-user-plus"></i>
                    <span>ثبت‌نام</span>
                </div>
                <div class="auth-tab" onclick="switchTab('recovery')" data-i18n="recovery" role="tab" aria-selected="false" aria-controls="recovery-content" tabindex="0"
                     title="بازیابی رمز عبور فراموش شده" 
                     aria-label="بازیابی رمز عبور">
                    <i class="fas fa-key"></i>
                    <span>بازیابی</span>
                </div>
            </div>
            
            <!-- Messages -->
            <div id="error-message" class="message error-message"></div>
            <div id="success-message" class="message success-message"></div>
            <div id="warning-message" class="message warning-message"></div>
            <div id="info-message" class="message info-message"></div>
            
            <!-- Login Form -->
            <div id="login-content" class="auth-content active" role="tabpanel" aria-labelledby="login-tab">
                <form id="login-form" role="form" aria-label="فرم ورود">
                    <div class="form-group">
                        <label for="login-username" id="login-username-label" data-i18n="username">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            نام کاربری:
                        </label>
                        <div class="input-group">
                            <input type="text" id="login-username" name="username" required 
                                   aria-labelledby="login-username-label" 
                                   aria-describedby="login-username-help"
                                   autocomplete="username"
                                   data-i18n-placeholder="usernamePlaceholder" placeholder="نام کاربری خود را وارد کنید">
                        </div>
                        <div id="login-username-help" class="sr-only" data-i18n="usernameHelp">نام کاربری خود را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password" id="login-password-label" data-i18n="password">
                            <i class="fas fa-lock" aria-hidden="true"></i>
                            رمز عبور:
                        </label>
                        <div class="input-group">
                            <input type="password" id="login-password" name="password" required 
                                   aria-labelledby="login-password-label" 
                                   aria-describedby="login-password-help"
                                   autocomplete="current-password"
                                   data-i18n-placeholder="passwordPlaceholder" placeholder="رمز عبور خود را وارد کنید">
                            <button type="button" class="password-toggle" onclick="togglePassword('login-password')" 
                                    aria-label="نمایش رمز عبور" 
                                    title="نمایش/مخفی کردن رمز عبور">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                </button>
                        </div>
                        <div id="login-password-help" class="sr-only" data-i18n="passwordHelp">رمز عبور خود را وارد کنید</div>
            </div>
            
                    <!-- CAPTCHA -->
                    <div class="captcha-container">
                        <label for="captcha-input" id="captcha-label" data-i18n="captcha">
                            <i class="fas fa-shield-alt" aria-hidden="true"></i>
                            کد امنیتی:
                        </label>
                                                 <canvas id="captcha-canvas" class="captcha-canvas" width="300" height="80" 
                                 role="img" aria-label="کد امنیتی - کلیک کنید تا تغییر کند" tabindex="0" 
                                 onclick="refreshCaptcha()" title="کلیک کنید تا کپچا عوض شود"></canvas>
                        <div class="input-group">
                            <input type="text" id="captcha-input" data-i18n-placeholder="captchaPlaceholder" placeholder="کد بالا را وارد کنید" required
                                   aria-labelledby="captcha-label" 
                                   aria-describedby="captcha-help"
                                   autocomplete="off">
                        </div>
                        <div id="captcha-help" class="sr-only" data-i18n="captchaHelp">کد امنیتی نمایش داده شده در تصویر بالا را وارد کنید</div>
                    </div>
                    
                                         <button type="submit" class="auth-btn" id="login-btn" 
                                 aria-label="ورود به سیستم" 
                                 title="برای ورود به سیستم کلیک کنید">
                        <span data-i18n="loginBtn">ورود</span>
                        <i class="fas fa-spinner spinner" aria-hidden="true"></i>
                    </button>
                </form>
                
                <div class="forgot-password">
                    <a href="#" onclick="switchTab('recovery')" data-i18n="forgotPassword" 
                       title="بازیابی رمز عبور فراموش شده" 
                       aria-label="بازیابی رمز عبور">رمز عبور را فراموش کرده‌اید؟</a>
                </div>
                
                <!-- Social Login -->
                <div class="social-login">
                    <div class="divider">
                        <span data-i18n="or">یا</span>
                    </div>
                    <button class="social-btn google" onclick="socialLogin('google')"
                            title="ورود با حساب گوگل" 
                            aria-label="ورود با گوگل">
                        <div class="social-btn-content">
                            <i class="fab fa-google"></i>
                            <span data-i18n="loginWithGoogle">ورود با گوگل</span>
                        </div>
                        <div class="social-btn-ripple"></div>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Login Form -->
            <div id="mobile-content" class="auth-content" role="tabpanel" aria-labelledby="mobile-tab">
                <div class="mobile-login-steps">
                    <!-- Step 1: Phone Number Input -->
                    <div class="step" id="mobile-step-1">
                        <div class="step-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h4 data-i18n="enterPhoneNumber">شماره تلفن خود را وارد کنید</h4>
                        
                        <form id="mobile-phone-form" class="mobile-form">
                            <div class="form-group">
                                <div class="phone-input-container">
                                    <div class="country-code">
                                        <span>+98</span>
                                    </div>
                                    <input 
                                        type="tel" 
                                        id="mobile-phone-input" 
                                        class="phone-input"
                                        placeholder="9123456789"
                                        maxlength="10"
                                        pattern="[0-9]{10}"
                                        required
                                        data-i18n-placeholder="phonePlaceholder"
                                    >
                                </div>

                            </div>
                            
                            <!-- CAPTCHA Section -->
                            <div class="form-group">
                                <div class="captcha-container mobile-captcha">
                                    <div class="captcha-image" id="mobile-captcha-image">
                                        <canvas id="mobile-captcha-canvas" class="captcha-canvas" width="300" height="80" 
                                            onclick="refreshMobileCaptcha()" title="کلیک کنید تا کپچا عوض شود"
                                            role="img" aria-label="کد امنیتی موبایل - کلیک کنید تا تغییر کند" tabindex="0"></canvas>
                                    </div>
                                </div>
                                <input 
                                    type="text" 
                                    id="mobile-captcha-input" 
                                    class="captcha-input"
                                    data-i18n-placeholder="captchaCodePlaceholder"
                                    placeholder="کد کپچا را وارد کنید"
                                    maxlength="6"
                                    required
                                >

                            </div>
                            
                                                         <button type="submit" class="auth-btn" id="mobile-send-btn" data-i18n="sendCode"
                                 title="ارسال کد تأیید به شماره موبایل" 
                                 aria-label="ارسال کد تأیید">
                                <i class="fas fa-paper-plane"></i>
                                <span class="btn-text">ارسال کد تأیید</span>
                                <span class="btn-loading" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    در حال ارسال...
                                </span>
                            </button>
                        </form>
                    </div>

                    <!-- Step 2: OTP Verification -->
                    <div class="step" id="mobile-step-2" style="display: none;">
                        <div class="step-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4 data-i18n="enterVerificationCode">کد تأیید را وارد کنید</h4>
                        <p class="step-description" data-i18n="otpDescription">
                            کد 6 رقمی ارسال شده به شماره <span id="display-phone"></span> را وارد کنید
                        </p>
                        
                        <form id="mobile-otp-form" class="mobile-form">
                            <div class="form-group">
                                <!-- Direct OTP input -->
                                <input type="text" id="direct-otp-input" class="direct-otp-input" 
                                       maxlength="6" pattern="[0-9]{6}" 
                                       placeholder="کد 6 رقمی را وارد کنید"
                                       required>
                                
                                <!-- Hidden individual inputs (kept for compatibility) -->
                                <div class="otp-input-container" style="display: none;">
                                    <input type="text" class="otp-input" maxlength="1" data-index="0" disabled>
                                    <input type="text" class="otp-input" maxlength="1" data-index="1" disabled>
                                    <input type="text" class="otp-input" maxlength="1" data-index="2" disabled>
                                    <input type="text" class="otp-input" maxlength="1" data-index="3" disabled>
                                    <input type="text" class="otp-input" maxlength="1" data-index="4" disabled>
                                    <input type="text" class="otp-input" maxlength="1" data-index="5" disabled>
                                </div>
                                <div class="otp-timer">
                                    <span data-i18n="resendCodeIn">ارسال مجدد کد در</span>
                                    <span id="otp-timer" class="timer">02:00</span>
                                </div>
                            </div>
                            
                            <div class="mobile-buttons">
                                                                 <button type="submit" class="auth-btn" id="mobile-verify-btn" data-i18n="verifyCode"
                                 title="تأیید کد وارد شده" 
                                 aria-label="تأیید کد">
                                    <i class="fas fa-check"></i>
                                    <span class="btn-text">تأیید کد</span>
                                    <span class="btn-loading" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        در حال تأیید...
                                    </span>
                                </button>
                                <button type="button" class="auth-btn secondary" onclick="resendOTP()" id="resend-btn" disabled>
                                    <i class="fas fa-redo"></i>
                                    <span class="btn-text" data-i18n="resendCode">ارسال مجدد</span>
                                    <span class="btn-loading" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        در حال ارسال...
                                    </span>
                                </button>
                                <button type="button" class="auth-btn secondary" onclick="backToPhoneStep()" id="back-btn">
                                    <i class="fas fa-arrow-right"></i>
                                    <span class="btn-text">تغییر شماره</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Step 3: Success -->
                    <div class="step" id="mobile-step-3" style="display: none;">
                        <div class="step-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 data-i18n="loginSuccessful">ورود موفقیت‌آمیز</h4>
                        <p class="step-description" data-i18n="welcomeMessage">
                            خوش آمدید! شما با موفقیت وارد سیستم شدید
                        </p>
                        
                        <div class="success-actions">
                            <button class="auth-btn" onclick="redirectToDashboard()" data-i18n="goToDashboard">
                                <i class="fas fa-home"></i>
                                رفتن به داشبورد
                            </button>
            </div>
        </div>
    </div>


            </div>
            
            <!-- Register Form -->
            <div id="register-content" class="auth-content">
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username" data-i18n="username">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            نام کاربری:
                        </label>
                        <div class="input-group">
                            <input type="text" id="register-username" name="username" required
                                   data-i18n-placeholder="usernamePlaceholder" placeholder="نام کاربری خود را وارد کنید">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-phone" data-i18n="phone">
                            <i class="fas fa-phone" aria-hidden="true"></i>
                            شماره تلفن:
                        </label>
                        <div class="input-group">
                            <input type="tel" id="register-phone" name="phone" data-i18n-placeholder="phonePlaceholder" placeholder="09123456789, +989123456789" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-email" data-i18n="email">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            ایمیل:
                        </label>
                        <div class="input-group">
                            <input type="email" id="register-email" name="email" data-i18n-placeholder="emailPlaceholder" placeholder="example@mail.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password" data-i18n="password">
                            <i class="fas fa-lock" aria-hidden="true"></i>
                            رمز عبور:
                        </label>
                        <div class="input-group">
                            <input type="password" id="register-password" name="password" required
                                   data-i18n-placeholder="passwordPlaceholder" placeholder="رمز عبور خود را وارد کنید">
                            <button type="button" class="password-toggle" onclick="togglePassword('register-password')" 
                                    aria-label="نمایش رمز عبور" 
                                    title="نمایش/مخفی کردن رمز عبور">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="password-strength">
                            <div class="strength-bar" id="strength-bar"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-confirm-password" data-i18n="confirmPassword">
                            <i class="fas fa-lock" aria-hidden="true"></i>
                            تأیید رمز عبور:
                        </label>
                        <div class="input-group">
                            <input type="password" id="register-confirm-password" name="confirm_password" required
                                   data-i18n-placeholder="confirmPasswordPlaceholder" placeholder="رمز عبور را تکرار کنید">
                            <button type="button" class="password-toggle" onclick="togglePassword('register-confirm-password')" 
                                    aria-label="نمایش رمز عبور" 
                                    title="نمایش/مخفی کردن رمز عبور">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- CAPTCHA for registration -->
                    <div class="captcha-container">
                        <label data-i18n="captcha">کد امنیتی:</label>
                                                                         <canvas id="register-captcha-canvas" class="captcha-canvas" width="300" height="80"
                                 onclick="refreshRegisterCaptcha()" title="کلیک کنید تا کپچا عوض شود"
                                 role="img" aria-label="کد امنیتی ثبت‌نام - کلیک کنید تا تغییر کند" tabindex="0"></canvas>
                        <div class="input-group">
                            <input type="text" id="register-captcha-input" data-i18n-placeholder="captchaPlaceholder" placeholder="کد بالا را وارد کنید" required>
                        </div>
                    </div>
                    
                                                                 <button type="submit" class="auth-btn" id="register-btn"
                                 title="ثبت‌نام در سیستم" 
                                 aria-label="ثبت‌نام">
                        <span data-i18n="registerBtn">ثبت‌نام</span>
                        <i class="fas fa-spinner spinner"></i>
                    </button>
                </form>
            </div>
            
            <!-- Recovery Form -->
            <div id="recovery-content" class="auth-content">
                <!-- Step 1: Send Recovery Code -->
                <div id="recovery-step1">
                    <form id="recovery-form">
                        <div class="form-group">
                            <label for="recovery-phone" data-i18n="phone">
                                <i class="fas fa-phone" aria-hidden="true"></i>
                                شماره تلفن:
                            </label>
                            <div class="input-group">
                                <input type="tel" id="recovery-phone" name="phone" data-i18n-placeholder="phonePlaceholder" placeholder="09123456789, +989123456789" required>
                            </div>
                        </div>
                        
                        <!-- CAPTCHA for recovery -->
                        <div class="captcha-container">
                            <label data-i18n="captcha">
                                <i class="fas fa-shield-alt" aria-hidden="true"></i>
                                کد امنیتی:
                            </label>
                                                                                 <canvas id="recovery-captcha-canvas" class="captcha-canvas" width="300" height="80"
                                 onclick="refreshRecoveryCaptcha()" title="کلیک کنید تا کپچا عوض شود"
                                 role="img" aria-label="کد امنیتی بازیابی - کلیک کنید تا تغییر کند" tabindex="0"></canvas>
                            <div class="input-group">
                                <input type="text" id="recovery-captcha-input" data-i18n-placeholder="captchaPlaceholder" placeholder="کد بالا را وارد کنید" required>
                            </div>
                        </div>
                        
                                                 <button type="submit" class="auth-btn" id="recovery-btn"
                                 title="ارسال کد بازیابی" 
                                 aria-label="ارسال کد بازیابی">
                            <span data-i18n="recoveryBtn">ارسال کد بازیابی</span>
                            <i class="fas fa-spinner spinner"></i>
                        </button>
                    </form>
                </div>
                
                <!-- Step 2: Enter Recovery Code and New Password -->
                <div id="recovery-step2" style="display: none;">
                    <form id="reset-password-form">
                        <div class="form-group">
                            <label for="recovery-code" data-i18n="recoveryCode">
                                <i class="fas fa-key" aria-hidden="true"></i>
                                کد بازیابی (6 رقمی):
                            </label>
                            <div class="input-group">
                                <input type="text" id="recovery-code" name="code" data-i18n-placeholder="recoveryCodePlaceholder" placeholder="کد 6 رقمی ارسال شده" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="new-password" data-i18n="newPassword">
                                <i class="fas fa-lock" aria-hidden="true"></i>
                                رمز عبور جدید:
                            </label>
                            <div class="input-group">
                                                            <input type="password" id="new-password" name="new_password" data-i18n-placeholder="newPasswordPlaceholder" placeholder="رمز عبور جدید" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('new-password')" 
                                    aria-label="نمایش رمز عبور" 
                                    title="نمایش/مخفی کردن رمز عبور">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                            </button>
                            </div>
                            <div class="password-strength">
                                <div class="strength-bar" id="reset-strength-bar"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm-new-password" data-i18n="confirmNewPassword">
                                <i class="fas fa-lock" aria-hidden="true"></i>
                                تأیید رمز عبور جدید:
                            </label>
                            <div class="input-group">
                                                            <input type="password" id="confirm-new-password" name="confirm_new_password" data-i18n-placeholder="confirmNewPasswordPlaceholder" placeholder="تأیید رمز عبور جدید" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('confirm-new-password')" 
                                    aria-label="نمایش رمز عبور" 
                                    title="نمایش/مخفی کردن رمز عبور">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                            </button>
                            </div>
                        </div>
                        
                        <button type="submit" class="auth-btn" id="reset-password-btn">
                            <span data-i18n="resetPasswordBtn">تغییر رمز عبور</span>
                            <i class="fas fa-spinner spinner"></i>
                        </button>
                        
                        <button type="button" class="auth-btn" id="back-to-step1-btn" style="margin-top: 10px; background: #6c757d;">
                            <span data-i18n="backToStep1">بازگشت به مرحله قبل</span>
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Two-Factor Authentication -->
            <div class="two-factor-section" id="two-factor-section">
                <h3 data-i18n="twoFactorTitle">احراز هویت دو مرحله‌ای</h3>
                <p data-i18n="twoFactorSubtitle">برای امنیت بیشتر، کد تأیید ارسال شده را وارد کنید:</p>
                
                <div class="qr-code" id="qr-code">
                    <canvas id="qr-canvas"></canvas>
                </div>
                
                <div class="otp-inputs">
                    <input type="text" class="otp-input" maxlength="1" data-index="0">
                    <input type="text" class="otp-input" maxlength="1" data-index="1">
                    <input type="text" class="otp-input" maxlength="1" data-index="2">
                    <input type="text" class="otp-input" maxlength="1" data-index="3">
                    <input type="text" class="otp-input" maxlength="1" data-index="4">
                    <input type="text" class="otp-input" maxlength="1" data-index="5">
                </div>
                
                <button class="auth-btn" onclick="verify2FA()">
                    <span data-i18n="verifyBtn">تأیید</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>
            

        </div>
    </div>

    <!-- Glass Footer -->
    <footer class="glass-footer" role="contentinfo" aria-label="فوتر اصلی">
        <div class="footer-content">
            <div class="footer-text">
                <i class="fas fa-heart" aria-hidden="true"></i>
                <span data-i18n="made_with_love">ساخته شده با عشق و دقت برای امنیت شما ❤️</span>
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link" data-i18n="privacy">حریم خصوصی</a>
                <a href="#" class="footer-link" data-i18n="terms">قوانین</a>
                <a href="#" class="footer-link" data-i18n="support">پشتیبانی</a>
                <a href="#" class="footer-link" data-i18n="about">درباره ما</a>
            </div>
        </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <script>
        // Global variables
        let currentTab = 'login';
        let captchaText = '';
        let registerCaptchaText = '';
        let recoveryCaptchaText = '';
        let twoFactorSecret = '';
        let loginAttempts = 0;
        let isAuthenticated = false;
        let currentLanguage = 'fa';
        let currentTheme = 'light';

        // Enhanced Translations
        const translations = {
            fa: {
                // Header & Navigation
                system_title: 'سیستم دوربین هوشمند',
                home: 'صفحه اصلی',
                theme: 'تم',
                language: 'زبان',
                
                // Main Content
                title: 'سیستم دوربین هوشمند',
                subtitle: 'ورود امن و سریع به سیستم',
                login: 'ورود',
            mobileLogin: 'ورود با موبایل',
                register: 'ثبت‌نام',
                recovery: 'بازیابی',
                
                // Form Fields
                username: 'نام کاربری:',
                password: 'رمز عبور:',
                phone: 'شماره تلفن:',
                confirmPassword: 'تأیید رمز عبور:',
                newPassword: 'رمز عبور جدید:',
                confirmNewPassword: 'تأیید رمز عبور جدید:',
                recoveryCode: 'کد بازیابی (6 رقمی):',
                captcha: 'کد امنیتی:',
                
                // Placeholders
            usernamePlaceholder: 'نام کاربری خود را وارد کنید',
            passwordPlaceholder: 'رمز عبور خود را وارد کنید',
            confirmPasswordPlaceholder: 'رمز عبور را تکرار کنید',
                captchaPlaceholder: 'کد بالا را وارد کنید',
                captchaCodePlaceholder: 'کد کپچا را وارد کنید',
            phonePlaceholder: '09123456789, +989123456789',
                recoveryCodePlaceholder: 'کد 6 رقمی ارسال شده',
                newPasswordPlaceholder: 'رمز عبور جدید',
                confirmNewPasswordPlaceholder: 'تأیید رمز عبور جدید',
                
                // Buttons
                loginBtn: 'ورود',
                registerBtn: 'ثبت‌نام',
                recoveryBtn: 'ارسال کد بازیابی',
                resetPasswordBtn: 'تغییر رمز عبور',
                backToStep1: 'بازگشت به مرحله قبل',
                verifyBtn: 'تأیید',
                
                // Links & Actions
                forgotPassword: 'رمز عبور را فراموش کرده‌اید؟',
                or: 'یا',
                loginWithGoogle: 'ورود با گوگل',
                loginWithMobile: 'ورود با موبایل',
                
                // Mobile Login Modal
                mobileLoginTitle: 'ورود با موبایل',
                enterPhoneNumber: 'شماره تلفن خود را وارد کنید',
                phoneNumberDescription: 'شماره تلفن معتبر خود را وارد کنید تا کد تأیید ارسال شود',
                phonePlaceholder: '9123456789',
                phoneFormatHelp: 'مثال: 9123456789',
                sendCode: 'ارسال کد تأیید',
                enterVerificationCode: 'کد تأیید را وارد کنید',
                otpDescription: 'کد 6 رقمی ارسال شده به شماره {phone} را وارد کنید',
                verifyCode: 'تأیید کد',
                resendCode: 'ارسال مجدد',
                resendCodeIn: 'ارسال مجدد کد در',
                loginSuccessful: 'ورود موفقیت‌آمیز',
                welcomeMessage: 'خوش آمدید! شما با موفقیت وارد سیستم شدید',
                goToDashboard: 'رفتن به داشبورد',
                backToLogin: 'بازگشت به ورود',
                
                // Footer
                made_with_love: 'ساخته شده با عشق و دقت برای امنیت شما ❤️',
                privacy: 'حریم خصوصی',
                terms: 'قوانین',
                support: 'پشتیبانی',
                about: 'درباره ما',

                
                // Status Messages
                loading: 'در حال بارگذاری...',
                error: 'خطا',
                success: 'موفقیت',
                warning: 'هشدار',
                info: 'اطلاعات',
                
                // Error Messages
                loginError: 'خطا در ورود. لطفاً دوباره تلاش کنید.',
                serverError: 'خطا در اتصال به سرور. لطفاً دوباره تلاش کنید.',
                captchaError: 'کد امنیتی اشتباه است',
                passwordMismatch: 'رمزهای عبور مطابقت ندارند',
                passwordRequirements: 'رمز عبور باید حداقل 8 کاراکتر و شامل حروف بزرگ، کوچک و اعداد باشد',
                phoneError: 'لطفاً شماره تلفن معتبر وارد کنید',
                otpError: 'لطفاً کد 6 رقمی را کامل وارد کنید',
                otpInvalid: 'کد تأیید نامعتبر است',
                otpResendError: 'خطا در ارسال مجدد کد',
                otpSendError: 'خطا در ارسال کد تأیید',
                registerError: 'خطا در ثبت‌نام. لطفاً دوباره تلاش کنید.',
                recoveryError: 'خطا در ارسال کد بازیابی.',
                recoveryCodeError: 'کد بازیابی باید 6 رقم باشد',
                resetPasswordError: 'خطا در تغییر رمز عبور. لطفاً دوباره تلاش کنید.',
                invalidProtocol: 'پروتکل ورود نامعتبر است',
                
                // Success Messages
                loginSuccess: 'ورود موفق! در حال انتقال...',
                registerSuccess: 'ثبت‌نام با موفقیت انجام شد',
                otpSent: 'کد تأیید ارسال شد',
                otpVerified: 'کد تأیید با موفقیت تأیید شد',
                recoverySent: 'کد بازیابی ارسال شد',
                passwordReset: 'رمز عبور با موفقیت تغییر یافت',
                
                // Warning Messages
                tooManyAttempts: 'تعداد تلاش‌های شما زیاد شده است. لطفاً 10 دقیقه صبر کنید.',
                
                // Two-Factor
                twoFactorTitle: 'احراز هویت دو مرحله‌ای',
                twoFactorSubtitle: 'برای امنیت بیشتر، کد تأیید ارسال شده را وارد کنید:',
                
                // Controls
                changeTheme: 'تغییر تم',
                changeLanguage: 'تغییر زبان',
                
                // Footer
                privacy: 'حریم خصوصی',
                terms: 'قوانین',
                support: 'پشتیبانی',
                about: 'درباره ما',
                made_with_love: 'ساخته شده با عشق و دقت برای امنیت شما ❤️',
                
                // Additional missing translations
                captchaLabel: 'کد امنیتی:',
                captchaHelp: 'کد امنیتی نمایش داده شده در تصویر بالا را وارد کنید',
                usernameHelp: 'نام کاربری خود را وارد کنید',
                passwordHelp: 'رمز عبور خود را وارد کنید',
                phoneHelp: 'شماره تلفن خود را وارد کنید',
                confirmPasswordHelp: 'رمز عبور را دوباره وارد کنید',
                newPasswordHelp: 'رمز عبور جدید خود را وارد کنید',
                confirmNewPasswordHelp: 'رمز عبور جدید را دوباره وارد کنید',
                recoveryCodeHelp: 'کد 6 رقمی ارسال شده به تلفن خود را وارد کنید',
                
                // Missing translation keys
                backToStep1: 'بازگشت به مرحله قبل'
            },
            en: {
                // Header & Navigation
                system_title: 'Smart Camera System',
                home: 'Home',
                theme: 'Theme',
                language: 'Language',
                
                // Main Content
                title: 'Smart Camera System',
                subtitle: 'Secure and fast system access',
                login: 'Login',
            mobileLogin: 'Mobile Login',
                register: 'Register',
                recovery: 'Recovery',
                
                // Form Fields
                username: 'Username:',
                password: 'Password:',
                phone: 'Phone Number:',
                confirmPassword: 'Confirm Password:',
                newPassword: 'New Password:',
                confirmNewPassword: 'Confirm New Password:',
                recoveryCode: 'Recovery Code (6 digits):',
                captcha: 'Security Code:',
                
                // Placeholders
            usernamePlaceholder: 'Enter your username',
            passwordPlaceholder: 'Enter your password',
            confirmPasswordPlaceholder: 'Confirm your password',
                captchaPlaceholder: 'Enter the code above',
                captchaCodePlaceholder: 'Enter captcha code',
            phonePlaceholder: '09123456789, +989123456789',
                recoveryCodePlaceholder: '6-digit code sent',
                newPasswordPlaceholder: 'New password',
                confirmNewPasswordPlaceholder: 'Confirm new password',
                
                // Buttons
                loginBtn: 'Login',
                registerBtn: 'Register',
                recoveryBtn: 'Send Recovery Code',
                resetPasswordBtn: 'Change Password',
                backToStep1: 'Back to Previous Step',
                verifyBtn: 'Verify',
                
                // Links & Actions
                forgotPassword: 'Forgot your password?',
                or: 'or',
                loginWithGoogle: 'Login with Google',
                loginWithMobile: 'Login with Mobile',
                
                // Mobile Login Modal
                mobileLoginTitle: 'Mobile Login',
                enterPhoneNumber: 'Enter your phone number',
                phoneNumberDescription: 'Enter your valid phone number to receive verification code',
                phonePlaceholder: '9123456789',
                phoneFormatHelp: 'Example: 9123456789',
                sendCode: 'Send Code',
                enterVerificationCode: 'Enter verification code',
                otpDescription: 'Enter the 6-digit code sent to {phone}',
                verifyCode: 'Verify Code',
                resendCode: 'Resend',
                resendCodeIn: 'Resend code in',
                loginSuccessful: 'Login Successful',
                welcomeMessage: 'Welcome! You have successfully logged in',
                goToDashboard: 'Go to Dashboard',
                backToLogin: 'Back to Login',
                
                // Footer
                made_with_love: 'Made with love and precision for your security ❤️',
                privacy: 'Privacy',
                terms: 'Terms',
                support: 'Support',
                about: 'About Us',

                
                // Status Messages
                loading: 'Loading...',
                error: 'Error',
                success: 'Success',
                warning: 'Warning',
                info: 'Info',
                
                // Error Messages
                loginError: 'Login error. Please try again.',
                serverError: 'Server connection error. Please try again.',
                captchaError: 'Security code is incorrect',
                passwordMismatch: 'Passwords do not match',
                passwordRequirements: 'Password must be at least 8 characters and include uppercase, lowercase letters and numbers',
                phoneError: 'Please enter a valid phone number',
                otpError: 'Please enter the complete 6-digit code',
                otpInvalid: 'Verification code is invalid',
                otpResendError: 'Error resending code',
                otpSendError: 'Error sending verification code',
                registerError: 'Registration error. Please try again.',
                recoveryError: 'Error sending recovery code.',
                recoveryCodeError: 'Recovery code must be 6 digits',
                resetPasswordError: 'Error changing password. Please try again.',
                invalidProtocol: 'Invalid login protocol',
                
                // Success Messages
                loginSuccess: 'Login successful! Redirecting...',
                registerSuccess: 'Registration completed successfully',
                otpSent: 'Verification code sent',
                otpVerified: 'Verification code verified successfully',
                recoverySent: 'Recovery code sent',
                passwordReset: 'Password changed successfully',
                
                // Warning Messages
                tooManyAttempts: 'Too many attempts. Please wait 10 minutes.',
                
                // Two-Factor
                twoFactorTitle: 'Two-Factor Authentication',
                twoFactorSubtitle: 'For additional security, enter the verification code sent:',
                
                // Controls
                changeTheme: 'Change Theme',
                changeLanguage: 'Change Language',
                
                // Footer
                privacy: 'Privacy',
                terms: 'Terms',
                support: 'Support',
                about: 'About',
                made_with_love: 'Made with love and precision for your security ❤️',
                
                // Additional missing translations
                captchaLabel: 'Security Code:',
                captchaHelp: 'Enter the security code shown in the image above',
                usernameHelp: 'Enter your username',
                passwordHelp: 'Enter your password',
                phoneHelp: 'Enter your phone number',
                confirmPasswordHelp: 'Re-enter your password',
                newPasswordHelp: 'Enter your new password',
                confirmNewPasswordHelp: 'Re-enter your new password',
                recoveryCodeHelp: 'Enter the 6-digit code sent to your phone',
                
                // Missing translation keys
                backToStep1: 'Back to Previous Step'
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DOM CONTENT LOADED ===');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            loadSettings();
            updateTranslations(); // Apply translations on load
            generateCaptcha();
            generateRegisterCaptcha();
            generateRecoveryCaptcha();
            generateMobileCaptcha();
            
            // Force mobile captcha generation after a delay to ensure DOM is ready
            setTimeout(async () => {
                await generateMobileCaptcha();
                console.log('Mobile captcha generated after delay');
            }, 1000);
            setupPasswordStrength();
            setupOTPInputs();
            setupRecoveryCodeInput();
            setupLanguageAndTheme();
            
            // Setup captcha validation with delay to ensure DOM is ready
            setTimeout(() => {
                setupCaptchaValidation();
            }, 100);
            
            // Additional setup after a longer delay to ensure everything is loaded
            setTimeout(() => {
                setupCaptchaValidation();
            }, 500);
            
            // Force setup after DOM is fully ready
            setTimeout(() => {
                setupCaptchaValidation();
            }, 1000);
            
            // Final setup to ensure everything works
            setTimeout(() => {
                setupCaptchaValidation();
            }, 2000);
            
            checkExistingSession();
            
            // Add a test click handler to document to see if clicks are being captured
            document.addEventListener('click', function(e) {
                console.log('Document click detected:', e.target.id, e.target.className);
            });
        });

        // Toggle theme function with optimized performance
        function toggleTheme() {
            console.log('=== TOGGLE THEME FUNCTION CALLED ===');
            console.log('Current theme before:', currentTheme);
            
            // Add transition class to body for smooth color changes
            document.body.classList.add('theme-transitioning');
            
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            console.log('New theme:', currentTheme);
            localStorage.setItem('theme', currentTheme);
            
            // Update theme with smooth transition
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeUI();
            

            
            // Remove transition class after animation completes
            setTimeout(() => {
                document.body.classList.remove('theme-transitioning');
            }, 800);
            
            // Scroll to top
            window.scrollTo(0, 0);
            console.log('=== TOGGLE THEME COMPLETED ===');
        }

        // Toggle language function
        async function toggleLanguage() {
            console.log('=== TOGGLE LANGUAGE FUNCTION CALLED ===');
            console.log('Current language before:', currentLanguage);
            currentLanguage = currentLanguage === 'fa' ? 'en' : 'fa';
            console.log('New language:', currentLanguage);
            localStorage.setItem('language', currentLanguage);
            
            // Update document direction and language
            document.documentElement.setAttribute('dir', currentLanguage === 'fa' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', currentLanguage);
            
            updateTranslations();
            
            // Regenerate CAPTCHA with new language
            generateCaptcha();
            generateRegisterCaptcha();
            generateRecoveryCaptcha();
            await generateMobileCaptcha();
            
            // Scroll to top
            window.scrollTo(0, 0);
            console.log('=== TOGGLE LANGUAGE COMPLETED ===');
        }
        
        // Go home function - Disabled
        function goHome() {
            // Do nothing - button disabled
        }

        // Load settings from localStorage
        function loadSettings() {
            console.log('=== LOAD SETTINGS CALLED ===');
            
            const savedLanguage = localStorage.getItem('language') || 'fa';
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            console.log('Saved language from localStorage:', savedLanguage);
            console.log('Saved theme from localStorage:', savedTheme);
            
            currentLanguage = savedLanguage;
            currentTheme = savedTheme;
            
            console.log('Set currentLanguage to:', currentLanguage);
            console.log('Set currentTheme to:', currentTheme);
            
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.documentElement.setAttribute('dir', currentLanguage === 'fa' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', currentLanguage);
            
            console.log('Set data-theme to:', currentTheme);
            console.log('Set dir to:', currentLanguage === 'fa' ? 'rtl' : 'ltr');
            console.log('Set lang to:', currentLanguage);
            console.log('=== LOAD SETTINGS COMPLETED ===');
        }

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggleBtn = input.parentElement.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
                toggleBtn.parentElement.setAttribute('aria-label', 'مخفی کردن رمز عبور');
            } else {
                input.type = 'password';
                toggleBtn.className = 'fas fa-eye';
                toggleBtn.parentElement.setAttribute('aria-label', 'نمایش رمز عبور');
            }
        }

        // Setup language and theme controls (simplified)
        function setupLanguageAndTheme() {
            console.log('=== SETUP LANGUAGE AND THEME STARTED ===');
            
            // Add event listeners directly
            const themeBtn = document.getElementById('themeBtn');
            const langBtn = document.getElementById('langBtn');
            const homeBtn = document.getElementById('homeBtn');
            
            console.log('Found elements:', {
                themeBtn: !!themeBtn,
                langBtn: !!langBtn,
                homeBtn: !!homeBtn
            });
            
            if (themeBtn) {
                console.log('Adding theme button listener');
                themeBtn.addEventListener('click', function(e) {
                    console.log('Theme button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    toggleTheme();
                });
                
                // Also add onclick as backup
                themeBtn.onclick = function(e) {
                    console.log('Theme button clicked via onclick!');
                    e.preventDefault();
                    e.stopPropagation();
                toggleTheme();
                };
            }
            
            if (langBtn) {
                console.log('Adding language button listener');
                langBtn.addEventListener('click', function(e) {
                    console.log('Language button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    toggleLanguage();
                });
                
                // Also add onclick as backup
                langBtn.onclick = function(e) {
                    console.log('Language button clicked via onclick!');
                    e.preventDefault();
                    e.stopPropagation();
                    toggleLanguage();
                };
            }
            
            if (homeBtn) {
                console.log('Adding home button listener');
                homeBtn.addEventListener('click', function(e) {
                    console.log('Home button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    goHome();
                });
                
                // Also add onclick as backup
                homeBtn.onclick = function(e) {
                    console.log('Home button clicked via onclick!');
                    e.preventDefault();
                    e.stopPropagation();
                    goHome();
                };
            }
            
            // Update initial state
            updateThemeUI();
            console.log('=== SETUP LANGUAGE AND THEME COMPLETED ===');
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            document.documentElement.setAttribute('dir', lang === 'fa' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', lang);
            
            updateTranslations();
        }

        // Social login function
        function socialLogin(provider) {
            if (provider === 'google') {
                window.location.href = '/auth/google';
            } else if (provider === 'mobile') {
                openMobileLogin();
            }
        }

        // Mobile Login Modal Functions
        let currentStep = 1;
        let phoneNumber = '';
        let otpTimer = null;
        let otpTimeLeft = 120; // 2 minutes
        let mobileCaptchaText = '';
        let mobileCaptchaId = '';

        function openMobileLogin() {
            console.log('Opening mobile login...');
            
            // Switch to mobile tab
            switchTab('mobile');
            
            // Reset mobile login state
            resetMobileLogin();
            generateMobileCaptcha();
            
            // Focus on first input
            setTimeout(() => {
                const phoneInput = document.getElementById('mobile-phone-input');
                if (phoneInput) {
                    phoneInput.focus();
                }
                
                // Ensure mobile captcha validation is set up
                setupMobileCaptchaValidation();
                
                // Clear any existing messages
                clearMessages();
            }, 300);
            
            console.log('Mobile login opened successfully');
        }

        function resetMobileLogin() {
            currentStep = 1;
            phoneNumber = '';
            clearOTPTimer();
            
            // Reset forms
            document.getElementById('mobile-phone-form').reset();
            document.getElementById('mobile-otp-form').reset();
            
            // Clear OTP inputs
            document.querySelectorAll('.otp-input').forEach(input => {
                input.value = '';
            });
            
            // Clear direct OTP input
            const directInput = document.getElementById('direct-otp-input');
            if (directInput) {
                directInput.value = '';
            }
            
            // Clear CAPTCHA
            const mobileCaptchaInput = document.getElementById('mobile-captcha-input');
            if (mobileCaptchaInput) {
                mobileCaptchaInput.value = '';
                mobileCaptchaInput.classList.remove('correct', 'error');
                mobileCaptchaInput.style.animation = 'none';
                mobileCaptchaInput.title = '';
                console.log('Mobile CAPTCHA input cleared');
            } else {
                console.log('mobile-captcha-input element not found for clearing');
            }
            
            // Clear display phone
            const displayPhoneElement = document.getElementById('display-phone');
            if (displayPhoneElement) {
                displayPhoneElement.textContent = '';
                console.log('Display phone cleared');
            } else {
                console.log('display-phone element not found for clearing');
            }
            
            // Show step 1, hide others
            document.getElementById('mobile-step-1').style.display = 'block';
            document.getElementById('mobile-step-2').style.display = 'none';
            document.getElementById('mobile-step-3').style.display = 'none';
            
            // Reset timer
            document.getElementById('otp-timer').textContent = '02:00';
            document.getElementById('resend-btn').disabled = true;
            
            // Generate new CAPTCHA
            generateMobileCaptcha();
            
            console.log('Mobile login reset completed');
        }

        function showStep(stepNumber) {
            // Get all steps
            const steps = document.querySelectorAll('.step');
            const currentStepElement = document.getElementById(`mobile-step-${currentStep}`);
            const nextStepElement = document.getElementById(`mobile-step-${stepNumber}`);
            
            // Add exit animation to current step
            if (currentStepElement && currentStep !== stepNumber) {
                currentStepElement.classList.add('step-exit');
                setTimeout(() => {
                    currentStepElement.style.display = 'none';
                    currentStepElement.classList.remove('step-exit');
                }, 300);
            }
            
            // Show and animate next step
            if (nextStepElement) {
                nextStepElement.style.display = 'block';
                nextStepElement.classList.add('step-enter');
                
                setTimeout(() => {
                    nextStepElement.classList.remove('step-enter');
                    nextStepElement.classList.add('active');
                }, 50);
            }
            
            // Hide other steps
            steps.forEach(step => {
                if (step.id !== `mobile-step-${stepNumber}`) {
                    step.style.display = 'none';
                    step.classList.remove('active', 'step-enter', 'step-exit');
                }
            });
            
            currentStep = stepNumber;
            
            // Setup OTP inputs when showing step 2
            if (stepNumber === 2) {
                setTimeout(() => {
                    setupOTPInputs();
                    // Ensure phone number is displayed with retry mechanism
                    if (phoneNumber) {
                        // Try immediately
                        if (!setDisplayPhoneNumber(phoneNumber)) {
                            // Retry after a short delay
                            setTimeout(() => {
                                if (!setDisplayPhoneNumber(phoneNumber)) {
                                    // Final retry
                                    setTimeout(() => {
                                        setDisplayPhoneNumber(phoneNumber);
                                    }, 200);
                                }
                            }, 100);
                        }
                    }
                }, 200); // Increased delay to ensure DOM is ready
            }
            
            // Scroll to top of modal body
            const modalBody = document.querySelector('.modal-body');
            if (modalBody) {
                modalBody.scrollTop = 0;
            }
        }

        function startOTPTimer() {
            clearOTPTimer();
            otpTimeLeft = 120;
            updateTimerDisplay();
            
            // Disable resend button initially
            const resendBtn = document.getElementById('resend-btn');
            if (resendBtn) {
                resendBtn.disabled = true;
            }
            
            otpTimer = setInterval(() => {
                otpTimeLeft--;
                updateTimerDisplay();
                
                if (otpTimeLeft <= 0) {
                    clearOTPTimer();
                    if (resendBtn) {
                        resendBtn.disabled = false;
                    }
                }
            }, 1000);
        }

        function clearOTPTimer() {
            if (otpTimer) {
                clearInterval(otpTimer);
                otpTimer = null;
            }
        }
        
        function clearOTPInputs() {
            // Clear direct input
            const directInput = document.getElementById('direct-otp-input');
            if (directInput) {
                directInput.value = '';
                console.log('Direct OTP input cleared');
            } else {
                console.error('direct-otp-input element not found for clearing');
            }
            
            // Clear hidden inputs
            const hiddenInputs = document.querySelectorAll('.otp-input');
            hiddenInputs.forEach(input => {
                input.value = '';
            });
            
            // Clear any autocomplete data
            if (directInput) {
                directInput.setAttribute('autocomplete', 'off');
                directInput.setAttribute('data-lpignore', 'true');
            }
        }
        


        function updateTimerDisplay() {
            const minutes = Math.floor(otpTimeLeft / 60);
            const seconds = otpTimeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('otp-timer').textContent = timeString;
        }

        async function resendOTP() {
            if (phoneNumber) {
                try {
                    // Show loading
                    showLoading('resend-btn');
                    
                    // Use the new resend endpoint without CAPTCHA
                    const baseUrl = 'http://' + window.location.host;
                    const response = await fetch(baseUrl + '/api/mobile/resend-otp', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify({ 
                            phone: phoneNumber,
                            client_ip: '127.0.0.1',
                            user_agent: 'Mobile Browser'
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Check if user already exists
                        if (data.is_existing_user) {
                            showMessage('success', 'کاربر موجود. کد تأیید مجدداً ارسال شد');
                        } else {
                            showMessage('success', 'کاربر جدید. کد تأیید مجدداً ارسال شد');
                        }
                        
                        // Restart timer
                        startOTPTimer();
                        // Clear OTP input
                        clearOTPInputs();
                        // Focus on OTP input
                        const directInput = document.getElementById('direct-otp-input');
                        if (directInput) {
                            directInput.focus();
                        }
                        
                        // Log for debugging
                        console.log('OTP resent successfully for phone:', phoneNumber);
                        console.log('Response data:', data);
                        console.log('Is existing user:', data.is_existing_user);
                    } else {
                        showMessage('error', data.detail || data.message || 'خطا در ارسال مجدد کد');
                    }
                } catch (error) {
                    console.error('Error resending OTP:', error);
                    showMessage('error', 'خطا در ارسال مجدد کد');
                } finally {
                    // Hide loading
                    hideLoading('resend-btn');
                }
            }
        }

        // Advanced Bot-Resistant Mobile CAPTCHA Generation
        async function generateMobileCaptcha() {
            const canvas = document.getElementById('mobile-captcha-canvas');
            if (!canvas) {
                console.log('Mobile captcha canvas not found');
                return;
            }
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Generate random text with mixed case and numbers - excluding confusing characters
            const chars = '023456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz';
            mobileCaptchaText = '';
            for (let i = 0; i < 6; i++) {
                mobileCaptchaText += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Generate unique ID for this CAPTCHA
            mobileCaptchaId = Date.now().toString(36) + Math.random().toString(36).substr(2);
            
            // Create complex gradient background
            const gradient = ctx.createRadialGradient(
                Math.random() * canvas.width, Math.random() * canvas.height, 0,
                Math.random() * canvas.width, Math.random() * canvas.height, canvas.width
            );
            gradient.addColorStop(0, `hsl(${Math.random() * 360}, 20%, 95%)`);
            gradient.addColorStop(0.5, `hsl(${Math.random() * 360}, 15%, 90%)`);
            gradient.addColorStop(1, `hsl(${Math.random() * 360}, 25%, 85%)`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add noise pattern
            for (let i = 0; i < 50; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.1)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 4 + 1,
                    Math.random() * 4 + 1
                );
            }
            
            // Add wavy lines behind text
            for (let i = 0; i < 8; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.3)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x += 5) {
                    const y = 30 + Math.sin(x * 0.02 + i) * 15 + Math.random() * 10;
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // Draw text with perfect centering and larger size
            const totalWidth = mobileCaptchaText.length * 40; // 40px per character
            const startX = (canvas.width - totalWidth) / 2; // Center the entire text
            
            for (let i = 0; i < mobileCaptchaText.length; i++) {
                ctx.save();
                
                // Perfectly centered position
                const x = startX + i * 40 + (Math.random() - 0.5) * 6;
                const y = 50 + (Math.random() - 0.5) * 4;
                
                ctx.translate(x, y);
                
                // Minimal rotation for better readability
                ctx.rotate((Math.random() - 0.5) * 0.2);
                
                // Much larger font size and weight
                const fontSize = 32 + Math.random() * 6;
                const fontWeight = Math.random() > 0.2 ? 'bold' : '600';
                ctx.font = `${fontWeight} ${fontSize}px Arial, sans-serif`;
                
                // Random color with better contrast for readability
                const colors = [
                    '#1f2937', '#374151', '#4b5563', '#6b7280',
                    '#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a',
                    '#dc2626', '#b91c1c', '#991b1b', '#7f1d1d',
                    '#059669', '#047857', '#065f46', '#064e3b'
                ];
                ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                
                // Add multiple shadows for depth
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                // Draw character with slight offset
                ctx.fillText(mobileCaptchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                // Add outline for extra confusion
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 0.5;
                ctx.strokeText(mobileCaptchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                ctx.restore();
            }
            
            // Add crossing lines through text
            for (let i = 0; i < 5; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.4)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.stroke();
            }
            
            // Add random shapes for extra confusion
            for (let i = 0; i < 3; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.2)`;
                if (Math.random() > 0.5) {
                    // Circle
                    ctx.beginPath();
                    ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 10 + 5, 0, 2 * Math.PI);
                    ctx.fill();
                } else {
                    // Rectangle
                    ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 20 + 10, Math.random() * 20 + 10);
                }
            }
            
            console.log('Mobile CAPTCHA generated:', mobileCaptchaText);
        }
        
        async function refreshMobileCaptcha() {
            await generateMobileCaptcha();
            // Clear and reset input field
            const input = document.getElementById('mobile-captcha-input');
            if (input) {
            input.value = '';
            input.classList.remove('correct', 'error');
            input.style.animation = 'none';
            input.title = '';
                input.focus();
                console.log('Mobile CAPTCHA refreshed');
            }
        }
        
        // Helper function to restart animation
        function restartAnimation(element, animationName) {
            // Remove any existing animation
            element.style.animation = 'none';
            element.offsetHeight; // Trigger reflow
            
            // Add the new animation after a small delay
            setTimeout(() => {
                element.style.animation = animationName;
            }, 50);
        }
        function validateMobileCaptcha() {
            const input = document.getElementById('mobile-captcha-input');
            const inputValue = input.value.trim();
            
            // Check if input is not empty
            if (!inputValue) {
            input.classList.remove('correct', 'error');
                input.title = '';
                input.style.animation = 'none';
                return false;
            }
            
            // Check if CAPTCHA matches (case-insensitive)
            const isValid = inputValue.toLowerCase() === mobileCaptchaText.toLowerCase();
                
            // Update visual feedback with enhanced animations
            input.classList.remove('correct', 'error');
            input.style.animation = 'none';
            
                if (isValid) {
                input.classList.add('correct');
                    input.title = 'کد امنیتی صحیح است ✓';
                input.style.animation = 'captchaCorrect 0.5s ease-in-out';
                // Add success sound effect (optional)
                console.log('CAPTCHA validation successful');
                } else {
                input.classList.add('error');
                    input.title = 'کد امنیتی اشتباه است ✗';
                input.style.animation = 'captchaError 0.5s ease-in-out';
                // Add error sound effect (optional)
                console.log('CAPTCHA validation failed');
            }
            
            // Auto-clear error state after 3 seconds
            if (!isValid) {
                setTimeout(() => {
                    input.classList.remove('error');
                    input.style.animation = 'none';
                }, 3000);
            }
            
            return isValid;
        }
        
        // Loading Functions
        function showLoading(buttonId) {
            const button = document.getElementById(buttonId);
            const btnText = button.querySelector('.btn-text');
            const btnLoading = button.querySelector('.btn-loading');
            
            btnText.classList.add('hide');
            btnLoading.classList.add('show');
            button.disabled = true;
        }
        
        function hideLoading(buttonId) {
            const button = document.getElementById(buttonId);
            const btnText = button.querySelector('.btn-text');
            const btnLoading = button.querySelector('.btn-loading');
            
            btnText.classList.remove('hide');
            btnLoading.classList.remove('show');
            button.disabled = false;
        }
        
        function processPhoneNumber(phone) {
            if (!phone || typeof phone !== 'string') return '';
            phone = phone.trim();
            
            // Remove all non-digit characters except leading +
            if (phone.startsWith('+')) {
                phone = '+' + phone.slice(1).replace(/[^\d]/g, '');
            } else {
                phone = phone.replace(/[^\d]/g, '');
            }
            
            // Remove country code
            if (phone.startsWith('+98')) {
                phone = phone.slice(3);
            } else if (phone.startsWith('0098')) {
                phone = phone.slice(4);
            } else if (phone.startsWith('98')) {
                phone = phone.slice(2);
            } else if (phone.startsWith('0')) {
                phone = phone.slice(1);
            }
            
            // Now should be 10 digits starting with 9
            const isValid = phone.length === 10 && phone.startsWith('9');
            //console.log('Phone processing:', { original: phone, processed: phone, isValid });
            return isValid ? phone : '';
        }

        async function sendOTP(phone) {
            try {
                // Process phone number to handle various formats
                const processedPhone = processPhoneNumber(phone);
                
                // Client-side validation
                if (!processedPhone) {
                    throw new Error('شماره تلفن نامعتبر است');
                }
                
                // CAPTCHA validation
                if (!validateMobileCaptcha()) {
                    throw new Error('کد کپچا نامعتبر است');
                }
                
                // Show loading
                showLoading('mobile-send-btn');
                
                // Use current protocol (HTTP/HTTPS) for compatibility
                const baseUrl = window.location.protocol + '//' + window.location.host;
                const response = await fetch(baseUrl + '/api/mobile/send-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({ 
                        phone: processedPhone,
                        captcha_text: document.getElementById('mobile-captcha-input').value.trim(),
                        user_agent: navigator.userAgent || 'Mobile Browser'
                    })
                });

                // Ensure JSON parsing, even if server misroutes to HTML (e.g., login page)
                let data;
                const contentType = response.headers.get('content-type') || '';
                if (contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    try { data = JSON.parse(text); } catch { data = { detail: 'serverError' }; }
                }

                if (response.ok) {
                    // Check if user already exists
                    if (data.is_existing_user) {
                        showMessage('success', 'کاربر موجود شناسایی شد. کد تأیید ارسال شد.');
                    } else {
                        showMessage('success', 'کاربر جدید. کد تأیید ارسال شد.');
                    }
                    
                    phoneNumber = processedPhone;
                    showStep(2);
                    
                    // Log for debugging
                    //console.log('OTP sent successfully for phone:', processedPhone);
                    //console.log('Response data:', data);
                    //console.log('Is existing user:', data.is_existing_user);
                    // Clear any existing OTP inputs
                    clearOTPInputs();
                    startOTPTimer();
                } else {
                                            showMessage('error', data.detail || data.message || 'otpSendError');
                    // Refresh CAPTCHA on error
                    await generateMobileCaptcha();
                    // Clear and reset input field
                    const input = document.getElementById('mobile-captcha-input');
                    input.value = '';
                    input.classList.remove('correct', 'error');
                }
            } catch (error) {
                console.error('Error sending OTP:', error);
                showMessage('error', 'serverError');
                // Refresh CAPTCHA on error
                await generateMobileCaptcha();
                // Clear and reset input field
                const input = document.getElementById('mobile-captcha-input');
                input.value = '';
                input.classList.remove('correct', 'error');
            } finally {
                // Hide loading
                hideLoading('mobile-send-btn');
            }
        }

        async function getClientIP() {
            // Simply return localhost IP to avoid external API issues
            return '127.0.0.1';
        }

        async function verifyOTP(otp) {
            try {
                //console.log('verifyOTP called with:', otp);
                
                // Client-side validation
                if (!otp || otp.length !== 6 || !/^[0-9]{6}$/.test(otp)) {
                    throw new Error('کد تأیید نامعتبر است');
                }
                
                // Show loading
                showLoading('mobile-verify-btn');
                
                // Use current protocol (HTTP/HTTPS) for compatibility
                const baseUrl = window.location.protocol + '//' + window.location.host;
                
                // Log for debugging
                //console.log('Verifying OTP for phone:', phoneNumber);
                //console.log('OTP to verify:', otp);
                
                const requestBody = { 
                    phone: phoneNumber,
                    otp: otp,
                    client_ip: '127.0.0.1', // Use local IP to avoid external API issues
                    user_agent: 'Mobile Browser' // Simplified user agent to avoid security detection
                };
                
                //console.log('Request body:', requestBody);
                
                const response = await fetch(baseUrl + '/api/mobile/verify-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(requestBody)
                });

                //console.log('Response status:', response.status);
                const data = await response.json();
                //console.log('Response data:', data);

                if (response.ok) {
                    // Check if user is existing or new
                    if (data.is_existing_user) {
                        const displayName = data.full_name && data.full_name.trim() ? data.full_name : data.username;
                        showMessage('success', `خوش آمدید ${displayName}! ورود موفقیت‌آمیز`);
                    } else {
                        showMessage('success', 'حساب کاربری جدید ایجاد شد. ورود موفقیت‌آمیز');
                    }
                    
                    showStep(3);
                    clearOTPTimer();
                    
                    // Store session token and user info
                    if (data.token) {
                        localStorage.setItem('session_token', data.token);
                        localStorage.setItem('user_id', data.user_id);
                        localStorage.setItem('username', data.username);
                        localStorage.setItem('user_phone', data.phone);
                        localStorage.setItem('login_method', 'mobile');
                        localStorage.setItem('user_email', data.email && data.email.trim() ? data.email : '');
                        localStorage.setItem('user_full_name', data.full_name && data.full_name.trim() ? data.full_name : '');
                        localStorage.setItem('is_existing_user', data.is_existing_user);
                        
                        // Also set cookie for server-side authentication
                        document.cookie = `access_token=${data.token}; path=/; max-age=86400; SameSite=Strict; Secure=false`;
                        
                        // Log for debugging
                       //console.log('Token stored and cookie set:', data.token);
                        //console.log('Login successful for phone:', phoneNumber);

                        //console.log('Response data:', data);
                    }
                    
                    // Auto-redirect to dashboard after 2 seconds
                    setTimeout(() => {
                        redirectToDashboard();
                    }, 2000);
                } else {
                    showMessage('error', data.detail || data.message || 'کد تأیید نامعتبر است');
                    // Clear OTP inputs on error
                    clearOTPInputs();
                    // Focus on direct input
                    const directInput = document.getElementById('direct-otp-input');
                    if (directInput) {
                        directInput.focus();
                    }
                }
            } catch (error) {
                console.error('Error verifying OTP:', error);
                showMessage('error', 'خطا در تأیید کد');
            } finally {
                // Hide loading
                hideLoading('mobile-verify-btn');
            }
        }

        function hideMessage() {
            const messageElement = document.querySelector('.message');
            if (messageElement) {
                messageElement.style.display = 'none';
            }
        }

        function setDisplayPhoneNumber(phoneNumber) {
            if (!phoneNumber) return false;
            
            // Try multiple selectors to find the element
            let displayPhoneElement = document.getElementById('display-phone');
            
            if (!displayPhoneElement) {
                // Try alternative selectors
                displayPhoneElement = document.querySelector('span#display-phone');
            }
            
            if (!displayPhoneElement) {
                // Try finding by text content pattern
                const spans = document.querySelectorAll('span');
                for (const span of spans) {
                    if (span.textContent.includes('کد 6 رقمی ارسال شده به شماره')) {
                        // Find the span inside this element
                        const innerSpan = span.querySelector('span');
                        if (innerSpan) {
                            displayPhoneElement = innerSpan;
                            break;
                        }
                    }
                }
            }
            
            if (displayPhoneElement) {
                displayPhoneElement.textContent = `+98${phoneNumber}`;
                //console.log('Phone number set successfully:', `+98${phoneNumber}`);
                return true;
            } else {
                console.log('display-phone element not found after multiple attempts');
                return false;
            }
        }

        function backToPhoneStep() {
            // Clear OTP inputs
            clearOTPInputs();
            // Clear timer
            clearOTPTimer();
            // Reset phone number
            phoneNumber = '';
            // Clear display phone
            const displayPhoneElement = document.getElementById('display-phone');
            if (displayPhoneElement) {
                displayPhoneElement.textContent = '';
                console.log('Display phone cleared in backToPhoneStep');
            } else {
                console.log('display-phone element not found for clearing in backToPhoneStep');
            }
            // Clear CAPTCHA
            const mobileCaptchaInput = document.getElementById('mobile-captcha-input');
            if (mobileCaptchaInput) {
                mobileCaptchaInput.value = '';
                mobileCaptchaInput.classList.remove('correct', 'error');
                mobileCaptchaInput.style.animation = 'none';
                mobileCaptchaInput.title = '';
                console.log('Mobile CAPTCHA input cleared in backToPhoneStep');
            }
            // Show step 1
            showStep(1);
            // Focus on phone input
            const phoneInput = document.getElementById('mobile-phone-input');
            if (phoneInput) {
                phoneInput.focus();
            }
            // Clear any error messages
            hideMessage();
        }

        function redirectToDashboard() {
            // Check if we have a valid token
            const token = localStorage.getItem('session_token');
            if (!token) {
                showMessage('error', 'خطا در احراز هویت');
                return;
            }
            
            // Test authentication before redirect
            fetch('/', {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            }).then(response => {
                if (response.ok) {
                    // Authentication successful, redirect
            window.location.href = '/';
                } else {
                    // Authentication failed, show error
                    showMessage('error', 'خطا در احراز هویت');
                }
            }).catch(error => {
                console.error('Auth test error:', error);
                // Try redirect anyway
                window.location.href = '/';
            });
        }

        // Setup OTP input handling
        function setupOTPInputs() {
            const directInput = document.getElementById('direct-otp-input');
            
            if (directInput) {
                // Clear any existing event listeners
                directInput.replaceWith(directInput.cloneNode(true));
            }
            
            // Re-select input after cloning
            const freshDirectInput = document.getElementById('direct-otp-input');
            
            if (freshDirectInput) {
                // Set input properties
                freshDirectInput.type = 'text';
                freshDirectInput.inputMode = 'numeric';
                freshDirectInput.pattern = '[0-9]*';
                freshDirectInput.maxLength = 6;
                freshDirectInput.name = 'otp'; // Add name attribute
                
                freshDirectInput.addEventListener('input', (e) => {
                    const value = e.target.value.replace(/\D/g, '').slice(0, 6);
                    e.target.value = value;
                    
                    console.log('OTP input value:', value);
                    
                    // Auto-submit when 6 digits are entered
                    if (value.length === 6) {
                        console.log('Auto-submitting OTP:', value);
                        setTimeout(() => {
                            verifyOTP(value);
                        }, 100);
                    }
                });
                
                freshDirectInput.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pastedData = e.clipboardData.getData('text');
                    const numbers = pastedData.replace(/\D/g, '').slice(0, 6);
                    
                    console.log('Pasted OTP:', numbers);
                    
                    if (numbers.length === 6) {
                        freshDirectInput.value = numbers;
                        setTimeout(() => {
                            verifyOTP(numbers);
                        }, 100);
                    }
                });
                
                // Focus on input when step is shown
                freshDirectInput.focus();
                console.log('OTP input setup completed');
            } else {
                console.error('direct-otp-input element not found');
            }
        }

        // Setup form submissions
        function setupMobileForms() {
            // Phone form submission
            document.getElementById('mobile-phone-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const phone = document.getElementById('mobile-phone-input').value.trim();
                
                // Process phone number to handle various formats
                const processedPhone = processPhoneNumber(phone);
                
                if (!processedPhone) {
                    showMessage('error', 'phoneError');
                    return;
                }
                
                // Store processed phone for later use
                phoneNumber = processedPhone;
                //console.log('Phone number processed and stored:', processedPhone);
                //console.log('Phone number will be displayed as: +98' + processedPhone);
                
                sendOTP(phone); // Send original phone to let server process it
            });
            
            // OTP form submission
            document.getElementById('mobile-otp-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const directInput = document.getElementById('direct-otp-input');
                const otp = directInput.value.trim();
                
                //console.log('Form submitted with OTP:', otp);
                
                if (otp.length !== 6) {
                    showMessage('error', 'کد تأیید باید 6 رقم باشد');
                    return;
                }
                
                if (!/^[0-9]{6}$/.test(otp)) {
                    showMessage('error', 'کد تأیید باید فقط شامل اعداد باشد');
                    return;
                }
                
                verifyOTP(otp);
            });
        }





        // Update theme UI
        function updateThemeUI() {
            console.log('=== UPDATE THEME UI CALLED ===');
            console.log('Current theme:', currentTheme);
            console.log('Current language:', currentLanguage);
            
            // Update header theme button
            const headerThemeBtn = document.getElementById('themeBtn');
            if (headerThemeBtn) {
                const icon = headerThemeBtn.querySelector('i');
                console.log('Found theme button icon:', !!icon);
                
                if (currentTheme === 'dark') {
                    icon.className = 'fas fa-sun';
                    headerThemeBtn.title = currentLanguage === 'fa' ? 'تغییر به تم روشن' : 'Switch to Light Theme';
                    console.log('Set to dark theme - sun icon');
                } else {
                    icon.className = 'fas fa-moon';
                    headerThemeBtn.title = currentLanguage === 'fa' ? 'تغییر به تم تاریک' : 'Switch to Dark Theme';
                    console.log('Set to light theme - moon icon');
                }
            } else {
                console.log('Theme button not found!');
            }
        }

        // Update translations
        // Enhanced translation update with font and direction management
        function updateTranslations() {
            console.log('=== UPDATE TRANSLATIONS CALLED ===');
            console.log('Current language:', currentLanguage);
            console.log('Available translations:', Object.keys(translations));
            
            const elements = document.querySelectorAll('[data-i18n]');
            console.log('Found elements with data-i18n:', elements.length);
            
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                    
                    // Update font class based on language
                    element.classList.remove('font-fa', 'font-en');
                    if (currentLanguage === 'fa') {
                        element.classList.add('font-fa');
                    } else if (currentLanguage === 'en') {
                        element.classList.add('font-en');
                    }
                }
            });
            
            // Update placeholders
            const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
            console.log('Found elements with data-i18n-placeholder:', placeholderElements.length);
            
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            // Update body direction, font, and language class
            document.body.classList.remove('font-fa', 'font-en', 'lang-fa', 'lang-en');
            if (currentLanguage === 'fa') {
                document.body.classList.add('font-fa', 'lang-fa');
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'fa');
                console.log('Set to RTL and Persian');
            } else if (currentLanguage === 'en') {
                document.body.classList.add('font-en', 'lang-en');
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', 'en');
                console.log('Set to LTR and English');
            }
            
            // Update page title
            document.title = translations[currentLanguage]?.title || 'Smart Camera System';
            console.log('=== UPDATE TRANSLATIONS COMPLETED ===');
        }


        let isPageLoaded = false;
        

        

        
        // Performance detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isLowEnd = navigator.hardwareConcurrency <= 2;
        const hasWeakGPU = !window.WebGLRenderingContext;
        

        

        

        

        

        


        // Switch between auth tabs with enhanced animations
        async function switchTab(tab) {
            console.log('Switching to tab:', tab);
            currentTab = tab;
            
            // Update tab buttons with animation
            document.querySelectorAll('.auth-tab').forEach(t => {
                t.classList.remove('active');
                t.style.transform = 'scale(0.95)';
                t.setAttribute('aria-selected', 'false');
            });
            
            // Find and activate the correct tab button
            const activeTabButton = document.querySelector(`.auth-tab[onclick="switchTab('${tab}')"]`);
            console.log('Found active tab button:', activeTabButton);
            if (activeTabButton) {
                activeTabButton.classList.add('active');
                activeTabButton.style.transform = 'scale(1)';
                activeTabButton.setAttribute('aria-selected', 'true');
            } else {
                console.error('Could not find active tab button for:', tab);
            }
            
            // Animate content transition
            const currentContent = document.querySelector('.auth-content.active');
            const newContent = document.getElementById(tab + '-content');
            
            if (currentContent && newContent) {
                currentContent.style.opacity = '0';
                currentContent.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    currentContent.classList.remove('active');
                    newContent.classList.add('active');
                    newContent.style.opacity = '0';
                    newContent.style.transform = 'translateX(20px)';
                    
                    setTimeout(() => {
                        newContent.style.opacity = '1';
                        newContent.style.transform = 'translateX(0)';
                    }, 50);
                }, 200);
            } else {
                // Update content without animation for first load
                document.querySelectorAll('.auth-content').forEach(c => c.classList.remove('active'));
                document.getElementById(tab + '-content').classList.add('active');
            }
            
            // Clear messages
            clearMessages();
            
            // Reset recovery form if switching to recovery tab
            if (tab === 'recovery') {
                document.getElementById('recovery-step1').style.display = 'block';
                document.getElementById('recovery-step2').style.display = 'none';
                document.getElementById('recovery-form').reset();
                document.getElementById('reset-password-form').reset();
                const recoveryInput = document.getElementById('recovery-captcha-input');
                if (recoveryInput) {
                    recoveryInput.value = '';
                    recoveryInput.classList.remove('correct', 'error');
                }
                generateRecoveryCaptcha();
            }
            
            // Reset mobile login if switching to mobile tab
            if (tab === 'mobile') {
                resetMobileLogin();
                await generateMobileCaptcha();
                setTimeout(() => {
                    const phoneInput = document.getElementById('mobile-phone-input');
                    if (phoneInput) {
                        phoneInput.focus();
                    }
                    setupMobileCaptchaValidation();
                    console.log('Mobile tab switched and reset completed');
                }, 300);
            }
            
            // Clear captcha input states when switching tabs
            const captchaInputs = [
                'captcha-input',
                'register-captcha-input',
                'recovery-captcha-input'
            ];
            
            captchaInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.classList.remove('correct', 'error');
                }
            });
            
            // Regenerate captcha for the new tab
            if (tab === 'login') generateCaptcha();
            else if (tab === 'register') generateRegisterCaptcha();
            else if (tab === 'recovery') generateRecoveryCaptcha();
            else if (tab === 'mobile') await generateMobileCaptcha();
            
            // Setup captcha validation for the new tab
            setTimeout(() => {
                setupCaptchaValidation();
            }, 300);
        }
        // Advanced Bot-Resistant CAPTCHA Generation
        function generateCaptcha() {
            const canvas = document.getElementById('captcha-canvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Generate random text with mixed case and numbers - excluding confusing characters
            const chars = '023456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz';
            captchaText = '';
            for (let i = 0; i < 6; i++) {
                captchaText += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Create complex gradient background
            const gradient = ctx.createRadialGradient(
                Math.random() * canvas.width, Math.random() * canvas.height, 0,
                Math.random() * canvas.width, Math.random() * canvas.height, canvas.width
            );
            gradient.addColorStop(0, `hsl(${Math.random() * 360}, 20%, 95%)`);
            gradient.addColorStop(0.5, `hsl(${Math.random() * 360}, 15%, 90%)`);
            gradient.addColorStop(1, `hsl(${Math.random() * 360}, 25%, 85%)`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add noise pattern
            for (let i = 0; i < 50; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.1)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 4 + 1,
                    Math.random() * 4 + 1
                );
            }
            
            // Add wavy lines behind text
            for (let i = 0; i < 8; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.3)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x += 5) {
                    const y = 30 + Math.sin(x * 0.02 + i) * 15 + Math.random() * 10;
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // Draw text with perfect centering and larger size
            const totalWidth = captchaText.length * 40; // 40px per character
            const startX = (canvas.width - totalWidth) / 2; // Center the entire text
            
            for (let i = 0; i < captchaText.length; i++) {
                ctx.save();
                
                // Perfectly centered position
                const x = startX + i * 40 + (Math.random() - 0.5) * 6;
                const y = 50 + (Math.random() - 0.5) * 4;
                
                ctx.translate(x, y);
                
                // Minimal rotation for better readability
                ctx.rotate((Math.random() - 0.5) * 0.2);
                
                // Much larger font size and weight
                const fontSize = 32 + Math.random() * 6;
                const fontWeight = Math.random() > 0.2 ? 'bold' : '600';
                ctx.font = `${fontWeight} ${fontSize}px Arial, sans-serif`;
                
                // Random color with better contrast for readability
                const colors = [
                    '#1f2937', '#374151', '#4b5563', '#6b7280',
                    '#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a',
                    '#dc2626', '#b91c1c', '#991b1b', '#7f1d1d',
                    '#059669', '#047857', '#065f46', '#064e3b'
                ];
                ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                
                // Add multiple shadows for depth
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                // Draw character with slight offset
                ctx.fillText(captchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                // Add outline for extra confusion
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 0.5;
                ctx.strokeText(captchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                ctx.restore();
            }
            
            // Add crossing lines through text
            for (let i = 0; i < 6; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.4)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                const x1 = Math.random() * canvas.width;
                const y1 = Math.random() * canvas.height;
                const x2 = Math.random() * canvas.width;
                const y2 = Math.random() * canvas.height;
                
                ctx.moveTo(x1, y1);
                const steps = 5;
                for (let j = 1; j <= steps; j++) {
                    const t = j / steps;
                    const x = x1 + (x2 - x1) * t + (Math.random() - 0.5) * 18;
                    const y = y1 + (y2 - y1) * t + (Math.random() - 0.5) * 18;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Add shapes
            for (let i = 0; i < 15; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.2)`;
                
                if (Math.random() > 0.5) {
                    ctx.beginPath();
                    ctx.arc(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 7 + 2,
                        0, 2 * Math.PI
                    );
                    ctx.fill();
                } else {
                    ctx.fillRect(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 9 + 3,
                        Math.random() * 9 + 3
                    );
                }
            }
            
            // Final noise layer
            for (let i = 0; i < 90; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.08)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    1, 1
                );
            }
        }

        function generateRegisterCaptcha() {
            const canvas = document.getElementById('register-captcha-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Generate mixed case text - excluding confusing characters
            const chars = '023456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz';
            registerCaptchaText = '';
            for (let i = 0; i < 6; i++) {
                registerCaptchaText += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Complex background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, `hsl(${Math.random() * 360}, 25%, 92%)`);
            gradient.addColorStop(1, `hsl(${Math.random() * 360}, 20%, 88%)`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add noise
            for (let i = 0; i < 60; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.15)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 3 + 1,
                    Math.random() * 3 + 1
                );
            }
            
            // Add wavy lines
            for (let i = 0; i < 6; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.4)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x += 3) {
                    const y = 30 + Math.sin(x * 0.03 + i) * 12 + Math.random() * 8;
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // Draw distorted text with perfect centering and larger size
            const totalWidth = registerCaptchaText.length * 40; // 40px per character
            const startX = (canvas.width - totalWidth) / 2; // Center the entire text
            
            for (let i = 0; i < registerCaptchaText.length; i++) {
                ctx.save();
                
                const x = startX + i * 40 + (Math.random() - 0.5) * 6;
                const y = 50 + (Math.random() - 0.5) * 4;
                
                ctx.translate(x, y);
                ctx.rotate((Math.random() - 0.5) * 0.2);
                
                const fontSize = 32 + Math.random() * 6;
                const fontWeight = Math.random() > 0.2 ? 'bold' : '600';
                ctx.font = `${fontWeight} ${fontSize}px Arial, sans-serif`;
                
                const colors = [
                    '#1f2937', '#374151', '#4b5563', '#6b7280',
                    '#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a',
                    '#dc2626', '#b91c1c', '#991b1b', '#7f1d1d',
                    '#059669', '#047857', '#065f46', '#064e3b'
                ];
                ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                ctx.shadowBlur = 2;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.fillText(registerCaptchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                ctx.restore();
            }
            
            // Add crossing lines
            for (let i = 0; i < 5; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.5)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                const x1 = Math.random() * canvas.width;
                const y1 = Math.random() * canvas.height;
                const x2 = Math.random() * canvas.width;
                const y2 = Math.random() * canvas.height;
                
                ctx.moveTo(x1, y1);
                const steps = 4;
                for (let j = 1; j <= steps; j++) {
                    const t = j / steps;
                    const x = x1 + (x2 - x1) * t + (Math.random() - 0.5) * 15;
                    const y = y1 + (y2 - y1) * t + (Math.random() - 0.5) * 15;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Add shapes
            for (let i = 0; i < 12; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.25)`;
                
                if (Math.random() > 0.5) {
                    ctx.beginPath();
                    ctx.arc(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 6 + 2,
                        0, 2 * Math.PI
                    );
                    ctx.fill();
                } else {
                    ctx.fillRect(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 8 + 3,
                        Math.random() * 8 + 3
                    );
                }
            }
            
            // Final noise
            for (let i = 0; i < 80; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.1)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    1, 1
                );
            }
        }

        function generateRecoveryCaptcha() {
            const canvas = document.getElementById('recovery-captcha-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Generate mixed case text - excluding confusing characters
            const chars = '023456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz';
            recoveryCaptchaText = '';
            for (let i = 0; i < 6; i++) {
                recoveryCaptchaText += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Complex background
            const gradient = ctx.createRadialGradient(
                Math.random() * canvas.width, Math.random() * canvas.height, 0,
                Math.random() * canvas.width, Math.random() * canvas.height, canvas.width
            );
            gradient.addColorStop(0, `hsl(${Math.random() * 360}, 20%, 94%)`);
            gradient.addColorStop(0.5, `hsl(${Math.random() * 360}, 15%, 90%)`);
            gradient.addColorStop(1, `hsl(${Math.random() * 360}, 25%, 86%)`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add noise pattern
            for (let i = 0; i < 70; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.12)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 4 + 1,
                    Math.random() * 4 + 1
                );
            }
            
            // Add wavy lines
            for (let i = 0; i < 7; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.35)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x += 4) {
                    const y = 30 + Math.sin(x * 0.025 + i) * 14 + Math.random() * 9;
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // Draw distorted text with perfect centering and larger size
            const totalWidth = recoveryCaptchaText.length * 40; // 40px per character
            const startX = (canvas.width - totalWidth) / 2; // Center the entire text
            
            for (let i = 0; i < recoveryCaptchaText.length; i++) {
                ctx.save();
                
                const x = startX + i * 40 + (Math.random() - 0.5) * 6;
                const y = 50 + (Math.random() - 0.5) * 4;
                
                ctx.translate(x, y);
                ctx.rotate((Math.random() - 0.5) * 0.2);
                
                const fontSize = 32 + Math.random() * 6;
                const fontWeight = Math.random() > 0.2 ? 'bold' : '600';
                ctx.font = `${fontWeight} ${fontSize}px Arial, sans-serif`;
                
                const colors = [
                    '#1f2937', '#374151', '#4b5563', '#6b7280',
                    '#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a',
                    '#dc2626', '#b91c1c', '#991b1b', '#7f1d1d',
                    '#059669', '#047857', '#065f46', '#064e3b'
                ];
                ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.45)';
                ctx.shadowBlur = 2.5;
                ctx.shadowOffsetX = 1.5;
                ctx.shadowOffsetY = 1.5;
                
                ctx.fillText(recoveryCaptchaText[i], Math.random() * 2 - 1, Math.random() * 2 - 1);
                
                ctx.restore();
            }
            
            // Add crossing lines
            for (let i = 0; i < 6; i++) {
                ctx.strokeStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.45)`;
                ctx.lineWidth = Math.random() * 2 + 1;
                ctx.beginPath();
                
                const x1 = Math.random() * canvas.width;
                const y1 = Math.random() * canvas.height;
                const x2 = Math.random() * canvas.width;
                const y2 = Math.random() * canvas.height;
                
                ctx.moveTo(x1, y1);
                const steps = 5;
                for (let j = 1; j <= steps; j++) {
                    const t = j / steps;
                    const x = x1 + (x2 - x1) * t + (Math.random() - 0.5) * 18;
                    const y = y1 + (y2 - y1) * t + (Math.random() - 0.5) * 18;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            // Add shapes
            for (let i = 0; i < 15; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.2)`;
                
                if (Math.random() > 0.5) {
                ctx.beginPath();
                    ctx.arc(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 7 + 2,
                        0, 2 * Math.PI
                    );
                    ctx.fill();
                } else {
                    ctx.fillRect(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        Math.random() * 9 + 3,
                        Math.random() * 9 + 3
                    );
                }
            }
            
            // Final noise layer
            for (let i = 0; i < 90; i++) {
                ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.08)`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    1, 1
                );
            }
        }

        // New Captcha Refresh Functions
        function refreshCaptcha() {
            generateCaptcha();
            // Clear and reset input field
            const input = document.getElementById('captcha-input');
            input.value = '';
            input.classList.remove('correct', 'error');
            input.style.animation = 'none';
            input.title = '';
        }

        function refreshRegisterCaptcha() {
            generateRegisterCaptcha();
            // Clear and reset input field
            const input = document.getElementById('register-captcha-input');
            input.value = '';
            input.classList.remove('correct', 'error');
            input.style.animation = 'none';
            input.title = '';
        }

        function refreshRecoveryCaptcha() {
            generateRecoveryCaptcha();
            // Clear and reset input field
            const input = document.getElementById('recovery-captcha-input');
            input.value = '';
            input.classList.remove('correct', 'error');
            input.style.animation = 'none';
            input.title = '';
        }

        // Captcha Validation Functions with Visual Feedback
        function validateCaptcha() {
            const input = document.getElementById('captcha-input');
            const inputValue = input.value.trim();
            const isValid = inputValue.toLowerCase() === captchaText.toLowerCase();
            
            // Update visual feedback
            input.classList.remove('correct', 'error');
            if (inputValue.length > 0) {
                input.classList.add(isValid ? 'correct' : 'error');
                
                // Force animation restart
                restartAnimation(input, isValid ? 'captchaSuccess 0.6s ease-in-out' : 'captchaError 0.6s ease-in-out');
                
                // Show brief success feedback
                if (isValid) {
                    input.title = 'کد امنیتی صحیح است ✓';
                } else {
                    input.title = 'کد امنیتی اشتباه است ✗';
                }
            } else {
                input.title = '';
            }
            
            return isValid;
        }

        function validateRegisterCaptcha() {
            const input = document.getElementById('register-captcha-input');
            const inputValue = input.value.trim();
            const isValid = inputValue.toLowerCase() === registerCaptchaText.toLowerCase();
            
            // Update visual feedback
            input.classList.remove('correct', 'error');
            if (inputValue.length > 0) {
                input.classList.add(isValid ? 'correct' : 'error');
                
                // Force animation restart
                restartAnimation(input, isValid ? 'captchaSuccess 0.6s ease-in-out' : 'captchaError 0.6s ease-in-out');
                
                // Show brief success feedback
                if (isValid) {
                    input.title = 'کد امنیتی صحیح است ✓';
                } else {
                    input.title = 'کد امنیتی اشتباه است ✗';
                }
            } else {
                input.title = '';
            }
            
            return isValid;
        }

        function validateRecoveryCaptcha() {
            const input = document.getElementById('recovery-captcha-input');
            const inputValue = input.value.trim();
            const isValid = inputValue.toLowerCase() === recoveryCaptchaText.toLowerCase();
            
            // Update visual feedback
            input.classList.remove('correct', 'error');
            if (inputValue.length > 0) {
                input.classList.add(isValid ? 'correct' : 'error');
                
                // Force animation restart
                restartAnimation(input, isValid ? 'captchaSuccess 0.6s ease-in-out' : 'captchaError 0.6s ease-in-out');
                
                // Show brief success feedback
                if (isValid) {
                    input.title = 'کد امنیتی صحیح است ✓';
                } else {
                    input.title = 'کد امنیتی اشتباه است ✗';
                }
            } else {
                input.title = '';
            }
            
            return isValid;
        }



        // Setup captcha validation with real-time feedback
        function setupCaptchaValidation() {
            
            // Login captcha
            const loginCaptchaInput = document.getElementById('captcha-input');
            if (loginCaptchaInput) {
                loginCaptchaInput.addEventListener('input', validateCaptcha);
            }

            // Register captcha
            const registerCaptchaInput = document.getElementById('register-captcha-input');
            if (registerCaptchaInput) {
                registerCaptchaInput.addEventListener('input', validateRegisterCaptcha);
            }

            // Recovery captcha
            const recoveryCaptchaInput = document.getElementById('recovery-captcha-input');
            if (recoveryCaptchaInput) {
                recoveryCaptchaInput.addEventListener('input', validateRecoveryCaptcha);
            }

            // Mobile captcha - will be set up when modal opens
            // The mobile captcha input is not available on page load
        }

        // Function to setup mobile captcha validation when modal opens
        function setupMobileCaptchaValidation() {
            const mobileCaptchaInput = document.getElementById('mobile-captcha-input');
            if (mobileCaptchaInput) {
                // Remove any existing listeners to avoid duplicates
                mobileCaptchaInput.removeEventListener('input', validateMobileCaptcha);
                mobileCaptchaInput.removeEventListener('blur', validateMobileCaptcha);
                mobileCaptchaInput.removeEventListener('keyup', validateMobileCaptcha);
                
                // Add the validation listeners
                mobileCaptchaInput.addEventListener('input', validateMobileCaptcha);
                mobileCaptchaInput.addEventListener('blur', validateMobileCaptcha);
                mobileCaptchaInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        validateMobileCaptcha();
                    }
                });
                
                console.log('Mobile CAPTCHA validation setup completed');
            } else {
                console.error('mobile-captcha-input element not found');
            }
        }

        // Setup password strength meter
        function setupPasswordStrength() {
            const passwordInput = document.getElementById('register-password');
            const strengthBar = document.getElementById('strength-bar');
            
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                const strength = calculatePasswordStrength(password);
                
                strengthBar.style.width = strength.score + '%';
                strengthBar.className = 'strength-bar strength-' + strength.level;
            });
            
            // Setup password strength for reset password form
            const newPasswordInput = document.getElementById('new-password');
            const resetStrengthBar = document.getElementById('reset-strength-bar');
            
            if (newPasswordInput && resetStrengthBar) {
                newPasswordInput.addEventListener('input', function() {
                    const password = this.value;
                    const strength = calculatePasswordStrength(password);
                    
                    resetStrengthBar.style.width = strength.score + '%';
                    resetStrengthBar.className = 'strength-bar strength-' + strength.level;
                });
            }
        }

        function calculatePasswordStrength(password) {
            let score = 0;
            
            if (password.length >= 8) score += 20;
            if (password.length >= 12) score += 10;
            if (/[a-z]/.test(password)) score += 15;
            if (/[A-Z]/.test(password)) score += 15;
            if (/[0-9]/.test(password)) score += 15;
            if (/[^A-Za-z0-9]/.test(password)) score += 15;
            if (password.length > 0) score += 10;
            
            let level = 'weak';
            if (score >= 60) level = 'medium';
            if (score >= 80) level = 'strong';
            
            return { score, level };
        }

        // Setup OTP inputs
        function setupOTPInputs() {
            const otpInputs = document.querySelectorAll('.otp-input');
            
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    if (this.value.length === 1) {
                        if (index < otpInputs.length - 1) {
                            otpInputs[index + 1].focus();
                        }
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value.length === 0) {
                        if (index > 0) {
                            otpInputs[index - 1].focus();
                        }
                    }
                });
            });
        }
        
        // Setup recovery code input to only accept numbers
        function setupRecoveryCodeInput() {
            const recoveryCodeInput = document.getElementById('recovery-code');
            if (recoveryCodeInput) {
                recoveryCodeInput.addEventListener('input', function() {
                    // Remove any non-numeric characters
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
                
                recoveryCodeInput.addEventListener('keypress', function(e) {
                    // Allow only numeric keys, backspace, delete, tab, escape, enter
                    if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Escape', 'Enter'].includes(e.key)) {
                        e.preventDefault();
                    }
                });
            }
        }

        // Show/hide loading
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // Clear all messages
        function clearMessages() {
            document.querySelectorAll('.message').forEach(msg => {
                msg.style.display = 'none';
                msg.style.opacity = '0';
                msg.style.transform = 'translateY(-20px) scale(0.95)';
            });
        }

        // Show message with enhanced glass design and animations
        function showMessage(type, text) {
            try {
                clearMessages();
                const messageElement = document.getElementById(type + '-message');
                if (messageElement) {
                    // Add icon based on message type
                    const icons = {
                        'error': 'fas fa-exclamation-circle',
                        'success': 'fas fa-check-circle',
                        'warning': 'fas fa-exclamation-triangle',
                        'info': 'fas fa-info-circle'
                    };
                    
                    const icon = icons[type] || 'fas fa-info-circle';
                    
                    // Check if text is a translation key
                    let displayText = text;
                    if (translations[currentLanguage] && translations[currentLanguage][text]) {
                        displayText = translations[currentLanguage][text];
                    }
                    
                    // Log for debugging
                    console.log('Showing message:', { type, text, displayText });
                    
                    // Use textContent and create elements safely
                    messageElement.textContent = '';
                    const iconElement = document.createElement('i');
                    iconElement.className = icon;
                    messageElement.appendChild(iconElement);
                    messageElement.appendChild(document.createTextNode(' ' + displayText));
                    messageElement.style.display = 'block';
                    
                    // Enhanced animation
                    messageElement.style.opacity = '0';
                    messageElement.style.transform = 'translateY(-20px) scale(0.95)';
                    
                    setTimeout(() => {
                        messageElement.style.opacity = '1';
                        messageElement.style.transform = 'translateY(0) scale(1)';
                    }, 10);
                    
                    // Auto-hide after 6 seconds with fade out
                    setTimeout(() => {
                        if (messageElement) {
                            messageElement.style.opacity = '0';
                            messageElement.style.transform = 'translateY(-10px) scale(0.98)';
                            setTimeout(() => {
                            messageElement.style.display = 'none';
                            }, 300);
                        }
                    }, 6000);
                } else {
                    console.warn(`Message element not found: ${type}-message`);
                    // Fallback: show alert if message element not found
                    alert(text);
                }
            } catch (error) {
                console.error('Error showing message:', error);
                // Fallback: show alert
                alert(text);
            }
        }
        // Helper function to get translated message
        function getTranslatedMessage(key) {
            if (translations[currentLanguage] && translations[currentLanguage][key]) {
                return translations[currentLanguage][key];
            }
            return key; // Return key if translation not found
        }

        // Enhanced toast-style notification function
        function showToast(type, text, duration = 4000) {
            try {
                // Create toast element
                const toast = document.createElement('div');
                toast.className = `message ${type}-message toast-notification`;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10000;
                    max-width: 350px;
                    min-width: 300px;
                    backdrop-filter: blur(25px);
                    border-radius: 12px;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
                    transform: translateX(400px);
                    opacity: 0;
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                `;
                
                // Add icon and text
                const icons = {
                    'error': 'fas fa-exclamation-circle',
                    'success': 'fas fa-check-circle',
                    'warning': 'fas fa-exclamation-triangle',
                    'info': 'fas fa-info-circle'
                };
                
                const icon = icons[type] || 'fas fa-info-circle';
                // Use textContent and create elements safely
                const iconElement = document.createElement('i');
                iconElement.className = icon;
                toast.appendChild(iconElement);
                toast.appendChild(document.createTextNode(' ' + text));
                
                // Add to body
                document.body.appendChild(toast);
                
                // Animate in
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                    toast.style.opacity = '1';
                }, 10);
                
                // Auto remove
                setTimeout(() => {
                    toast.style.transform = 'translateX(400px)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 400);
                }, duration);
                
                // Click to dismiss
                toast.addEventListener('click', () => {
                    toast.style.transform = 'translateX(400px)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 400);
                });
                
            } catch (error) {
                console.error('Error showing toast:', error);
                showMessage(type, text);
            }
        }

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const captcha = document.getElementById('captcha-input').value;
            
            // Validate CAPTCHA
            if (!validateCaptcha()) {
                showMessage('error', 'کد امنیتی اشتباه است');
                generateCaptcha();
                document.getElementById('captcha-input').value = '';
                return;
            }
            
            // Show loading
            const loginBtn = document.getElementById('login-btn');
            loginBtn.disabled = true;
            loginBtn.querySelector('.spinner').style.display = 'inline';
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Check if 2FA is required
                    if (data.requires_2fa) {
                        show2FASection(data.qr_code, data.secret);
                    } else {
                        // Normal login success
                        localStorage.setItem('access_token', data.access_token);
                        localStorage.setItem('token_expires', Date.now() + (data.expires_in * 1000));
                        
                        // Set token in cookie for server-side access
                        document.cookie = `access_token=${data.access_token}; path=/; max-age=${data.expires_in}; SameSite=Lax`;
                        
                        // Setup authorization headers
                        setupAuthHeader();
                        
                        showMessage('success', 'ورود موفق! در حال انتقال...');
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 1500);
                    }
                } else {
                    loginAttempts++;
                    showMessage('error', data.detail || 'خطا در ورود. لطفاً دوباره تلاش کنید.');
                    generateCaptcha();
                    const input = document.getElementById('captcha-input');
                    input.value = '';
                    input.classList.remove('correct', 'error');
                    
                    if (loginAttempts >= 3) {
                        showMessage('warning', 'تعداد تلاش‌های شما زیاد شده است. لطفاً 10 دقیقه صبر کنید.');
                    }
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'خطا در اتصال به سرور. لطفاً دوباره تلاش کنید.');
                generateCaptcha();
                const input = document.getElementById('captcha-input');
                input.value = '';
                input.classList.remove('correct', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.querySelector('.spinner').style.display = 'none';
            }
        });

        // Function to setup authorization header for authenticated requests
        function setupAuthHeader() {
            const token = localStorage.getItem('access_token');
            if (token) {
                // Override fetch to include Authorization header
                if (window.fetch) {
                    const originalFetch = window.fetch;
                    window.fetch = function(url, options = {}) {
                        if (!options.headers) {
                            options.headers = {};
                        }
                        options.headers['Authorization'] = `Bearer ${token}`;
                        return originalFetch(url, options);
                    };
                }
                
                // Override XMLHttpRequest to include Authorization header
                if (window.XMLHttpRequest) {
                    const originalOpen = XMLHttpRequest.prototype.open;
                    XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
                        this.addEventListener('readystatechange', function() {
                            if (this.readyState === 1) { // OPENED
                                const token = localStorage.getItem('access_token');
                                if (token) {
                                    this.setRequestHeader('Authorization', `Bearer ${token}`);
                                }
                            }
                        });
                        return originalOpen.call(this, method, url, async, user, password);
                    };
                }
                
                // Set token in cookie for server-side access
                document.cookie = `access_token=${token}; path=/; max-age=${60*60}; SameSite=Lax`;
            }
        }

        // Setup auth header on page load if token exists
        setupAuthHeader();
        
        // Also setup when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupAuthHeader();
        });

        // Function to get CSRF token
        async function getCSRFToken() {
            try {
                const response = await fetch('/csrf-token', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return {
                        token: data.csrf_token,
                        sessionId: data.session_id
                    };
                } else {
                    throw new Error('Failed to get CSRF token');
                }
            } catch (error) {
                console.error('Error getting CSRF token:', error);
                throw error;
            }
        }

        // Register form handler
        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('register-username').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const email = document.getElementById('register-email').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const captcha = document.getElementById('register-captcha-input').value;
            
            // Debug: Log the extracted values
            console.log('🔍 Extracted form values:');
            console.log('  Username:', username);
            console.log('  Phone:', phone);
            console.log('  Password length:', password ? password.length : 0);
            console.log('  Email:', email);
            // Validate email format only if provided
            if (email && email.trim() !== '') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showMessage('error', 'فرمت ایمیل صحیح نیست.');
                    return;
                }
            }

            console.log('  Confirm password length:', confirmPassword ? confirmPassword.length : 0);
            console.log('  Captcha:', captcha);
            
            // Validate phone number format
            const phoneRegex = /^(\+989\d{9}|09\d{9}|9\d{9})$/;
            if (!phoneRegex.test(phone)) {
                showMessage('error', 'فرمت شماره تلفن اشتباه است. لطفاً از فرمت 09xxxxxxxxx یا 9xxxxxxxxx استفاده کنید.');
                return;
            }
            
            // Validate password match
            if (password !== confirmPassword) {
                showMessage('error', 'رمزهای عبور مطابقت ندارند');
                return;
            }
            
            // Validate password strength
            const strength = calculatePasswordStrength(password);
            if (strength.level === 'weak') {
                showMessage('error', 'رمز عبور باید حداقل 8 کاراکتر و شامل حروف بزرگ، کوچک و اعداد باشد');
                return;
            }
            
            // Validate CAPTCHA
            if (!validateRegisterCaptcha()) {
                showMessage('error', 'کد امنیتی اشتباه است');
                generateRegisterCaptcha();
                const input = document.getElementById('register-captcha-input');
                input.value = '';
                input.classList.remove('correct', 'error');
                return;
            }
            
            const registerBtn = document.getElementById('register-btn');
            registerBtn.disabled = true;
            registerBtn.querySelector('.spinner').style.display = 'inline';
            
            try {
                // Get CSRF token first
                const csrfData = await getCSRFToken();
                
                // Debug: Log the data being sent
                const requestData = {
                    username: username,
                    phone: phone,
                    password: password
                };
                if (email && email.trim() !== '') {
                    requestData.email = email.trim();
                }
                console.log('📤 Sending registration data:', requestData);
                
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': csrfData.token,
                        'X-Session-ID': csrfData.sessionId
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                // Debug: Log the response
                console.log('📥 Registration response status:', response.status);
                console.log('📥 Registration response data:', data);
                
                if (response.ok) {
                    showMessage('success', 'ثبت‌نام موفق! لطفاً وارد شوید.');
                    setTimeout(() => {
                        switchTab('login');
                    }, 2000);
                } else {
                    showMessage('error', data.detail || 'خطا در ثبت‌نام. لطفاً دوباره تلاش کنید.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'خطا در اتصال به سرور. لطفاً دوباره تلاش کنید.');
            } finally {
                registerBtn.disabled = false;
                registerBtn.querySelector('.spinner').style.display = 'none';
            }
        });

        // Recovery form handler
        document.getElementById('recovery-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('recovery-phone').value;
            const captcha = document.getElementById('recovery-captcha-input').value;
            
            // Validate CAPTCHA
            if (!validateRecoveryCaptcha()) {
                showMessage('error', 'کد امنیتی اشتباه است');
                generateRecoveryCaptcha();
                const input = document.getElementById('recovery-captcha-input');
                input.value = '';
                input.classList.remove('correct', 'error');
                return;
            }
            
            const recoveryBtn = document.getElementById('recovery-btn');
            recoveryBtn.disabled = true;
            recoveryBtn.querySelector('.spinner').style.display = 'inline';
            
            try {
                // Get CSRF token first
                const csrfData = await getCSRFToken();
                
                const response = await fetch('/recover-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': csrfData.token,
                        'X-Session-ID': csrfData.sessionId
                    },
                    body: JSON.stringify({
                        phone: phone
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('success', 'کد بازیابی به شماره تلفن شما ارسال شد.');
                    // Switch to step 2
                    document.getElementById('recovery-step1').style.display = 'none';
                    document.getElementById('recovery-step2').style.display = 'block';
                    document.getElementById('recovery-form').reset(); // Reset step 1 form
                    document.getElementById('recovery-captcha-input').value = ''; // Clear captcha for step 2
                    document.getElementById('recovery-code').focus(); // Focus on recovery code input
                } else {
                    showMessage('error', data.detail || 'خطا در ارسال کد بازیابی.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'خطا در اتصال به سرور. لطفاً دوباره تلاش کنید.');
            } finally {
                recoveryBtn.disabled = false;
                recoveryBtn.querySelector('.spinner').style.display = 'none';
            }
        });

        // Reset password form handler
        document.getElementById('reset-password-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
                         const recoveryCode = document.getElementById('recovery-code').value;
             const newPassword = document.getElementById('new-password').value;
             const confirmNewPassword = document.getElementById('confirm-new-password').value;
             
             // Validate recovery code
             if (!/^\d{6}$/.test(recoveryCode)) {
                 showMessage('error', 'کد بازیابی باید 6 رقم باشد');
                 return;
             }
            
            // Validate password match
            if (newPassword !== confirmNewPassword) {
                showMessage('error', 'رمزهای عبور مطابقت ندارند');
                return;
            }

                         // Validate password strength
             const strength = calculatePasswordStrength(newPassword);
             if (strength.level === 'weak') {
                 showMessage('error', 'رمز عبور جدید باید حداقل 8 کاراکتر و شامل حروف بزرگ، کوچک و اعداد باشد');
                 return;
             }
             
             // Show loading
             const resetBtn = document.getElementById('reset-password-btn');
             resetBtn.disabled = true;
             resetBtn.querySelector('.spinner').style.display = 'inline';

            try {
                // Get CSRF token first
                const csrfData = await getCSRFToken();
                
                const response = await fetch('/reset-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-Token': csrfData.token,
                        'X-Session-ID': csrfData.sessionId
                    },
                    body: JSON.stringify({
                        code: recoveryCode,
                        new_password: newPassword
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('success', 'رمز عبور با موفقیت تغییر یافت.');
                    setTimeout(() => {
                        switchTab('login');
                    }, 2000);
                } else {
                    showMessage('error', data.detail || 'خطا در تغییر رمز عبور. لطفاً دوباره تلاش کنید.');
                }
                
                         } catch (error) {
                 console.error('Error:', error);
                 showMessage('error', 'خطا در اتصال به سرور. لطفاً دوباره تلاش کنید.');
             } finally {
                 resetBtn.disabled = false;
                 resetBtn.querySelector('.spinner').style.display = 'none';
             }
        });

                 // Back to step 1 button handler
         document.getElementById('back-to-step1-btn').addEventListener('click', function() {
             document.getElementById('recovery-step1').style.display = 'block';
             document.getElementById('recovery-step2').style.display = 'none';
             document.getElementById('reset-password-form').reset(); // Reset step 2 form
             document.getElementById('recovery-form').reset(); // Reset step 1 form
             document.getElementById('recovery-captcha-input').value = ''; // Clear captcha
             generateRecoveryCaptcha(); // Regenerate captcha
             clearMessages(); // Clear any messages
         });

        // Show 2FA section
        function show2FASection(qrCodeData, secret) {
            twoFactorSecret = secret;
            
            // Generate QR code
            const canvas = document.getElementById('qr-canvas');
            QRCode.toCanvas(canvas, qrCodeData, function (error) {
                if (error) console.error(error);
            });
            
            // Show 2FA section
            document.getElementById('two-factor-section').style.display = 'block';
            document.getElementById('login-content').style.display = 'none';
        }

        // Verify 2FA
        async function verify2FA() {
            const otpInputs = document.querySelectorAll('.otp-input');
            const otp = Array.from(otpInputs).map(input => input.value).join('');
            
            if (otp.length !== 6) {
                showMessage('error', 'لطفاً کد 6 رقمی را کامل وارد کنید');
                return;
            }
            
            try {
                const response = await fetch('/verify-2fa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        secret: twoFactorSecret,
                        otp: otp
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('token_expires', Date.now() + (data.expires_in * 1000));
                    
                    showMessage('success', 'احراز هویت موفق! در حال انتقال...');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1500);
                } else {
                    showMessage('error', data.detail || 'کد تأیید اشتباه است');
                    // Clear OTP inputs
                    otpInputs.forEach(input => input.value = '');
                    otpInputs[0].focus();
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'خطا در تأیید کد');
            }
        }

        // Social login
        function socialLogin(provider) {
            if (provider === 'google') {
                showMessage('info', 'در حال اتصال به گوگل...');
                // Redirect to Google OAuth
                window.location.href = '/auth/google';
            } else if (provider === 'mobile') {
                // Switch to mobile tab instead of modal
                switchTab('mobile');
            } else {
                showMessage('error', 'پروتکل ورود نامعتبر است');
            }
        }

        // Check existing session
        function checkExistingSession() {
            const token = localStorage.getItem('access_token');
            const expires = localStorage.getItem('token_expires');
            
            if (token && expires && Date.now() < parseInt(expires)) {
                // Add a small delay to prevent interference with language switching
                setTimeout(() => {
                window.location.href = '/';
                }, 500);
            } else {
                localStorage.removeItem('access_token');
                localStorage.removeItem('token_expires');
                sessionStorage.clear();
            }
        }

        // CAPTCHA click to regenerate
        document.getElementById('captcha-canvas').addEventListener('click', generateCaptcha);
        document.getElementById('register-captcha-canvas').addEventListener('click', generateRegisterCaptcha);
        document.getElementById('recovery-captcha-canvas').addEventListener('click', generateRecoveryCaptcha);
        
        // Mobile captcha event listener with error handling
        const mobileCaptchaCanvas = document.getElementById('mobile-captcha-canvas');
        if (mobileCaptchaCanvas) {
            mobileCaptchaCanvas.addEventListener('click', refreshMobileCaptcha);
            console.log('Mobile captcha event listener added');
        } else {
            console.log('Mobile captcha canvas not found');
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/logout', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('token_expires');
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

                // Smart Header and Footer Management
        let headerTimeout;
        let footerTimeout;
        let lastScrollY = 0;
        let isAtTop = true;
        let isAtBottom = false;

        function handleHeaderVisibility() {
            const header = document.getElementById('smartHeader');
            const footer = document.querySelector('.glass-footer');
            const currentScrollY = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Check if at top
            isAtTop = currentScrollY <= 50;
            
            // Check if at bottom
            isAtBottom = currentScrollY + windowHeight >= documentHeight - 50;
            
            // Header behavior: hide on scroll down, show on scroll up or at top
            if (currentScrollY > lastScrollY && currentScrollY > 100 && !isAtTop) {
                // Scrolling down - hide header
                header.classList.add('hidden');
            } else if (currentScrollY < lastScrollY || isAtTop) {
                // Scrolling up or at top - show header
                header.classList.remove('hidden');
            }
            
            // Footer behavior: always visible at bottom
            footer.classList.remove('hidden');
            
            lastScrollY = currentScrollY;
        }

        // Auto-hide header after 3 seconds
        function autoHideHeader() {
            headerTimeout = setTimeout(() => {
                document.getElementById('smartHeader').classList.remove('visible');
            }, 3000);
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Debounced header visibility handler
        const debouncedHeaderVisibility = debounce(handleHeaderVisibility, 10);

        // Event listeners for header and footer
        window.addEventListener('scroll', debouncedHeaderVisibility);
        window.addEventListener('resize', debouncedHeaderVisibility);
        
        // Initialize header and footer visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            handleHeaderVisibility();
            
            // Ensure footer is visible on page load
            const footer = document.querySelector('.glass-footer');
            if (footer) {
                footer.classList.remove('hidden');
                footer.style.transform = 'translateY(0)';
                footer.style.opacity = '1';
            }
            
            

            

        });
        


        // Typing animation for dynamic text with XSS protection
        function typeWriter(element, text, speed = 100) {
            let i = 0;
            element.textContent = '';
            
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        // Initialize typing animations
        function initTypingAnimations() {
            const typingElements = document.querySelectorAll('[data-typing]:not([data-i18n])');
            typingElements.forEach((element, index) => {
                setTimeout(() => {
                    const text = element.getAttribute('data-typing');
                    typeWriter(element, text);
                }, index * 1000);
            });
        }



        // Header button event listeners
        function setupHeaderButtons() {
            const homeBtn = document.getElementById('homeBtn');
            const themeBtn = document.getElementById('themeBtn');
            const langBtn = document.getElementById('langBtn');

            if (homeBtn) {
                homeBtn.addEventListener('click', () => {
                    window.location.href = '/';
                });
            }

            if (themeBtn) {
                themeBtn.addEventListener('click', () => {
                    toggleTheme();
                });
            }

            if (langBtn) {
                langBtn.addEventListener('click', () => {
                    toggleLanguage();
                });
            }
        }

        // Keyboard navigation for tabs
        function setupKeyboardNavigation() {
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const tabName = this.getAttribute('data-i18n');
                        switchTab(tabName === 'login' ? 'login' : tabName === 'register' ? 'register' : 'recovery');
                    }
                });
            });
        }

        // Initialize everything when page loads with enhanced error handling
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Initialize performance monitoring
                if (typeof performance !== 'undefined') {
                    performance.mark('page-load-start');
                }
                
                // Initialize core functionality
            initTypingAnimations();
            handleHeaderVisibility();
            setupHeaderButtons();
            setupKeyboardNavigation();
            setupOTPInputs();
            setupMobileForms();
                
                // Performance monitoring
                if (typeof performance !== 'undefined') {
                    performance.mark('page-load-end');
                    performance.measure('page-load', 'page-load-start', 'page-load-end');
                    
                    const measure = performance.getEntriesByName('page-load')[0];
                    console.log(`Page load time: ${measure.duration.toFixed(2)}ms`);
                }
                
                
                
            } catch (error) {
                console.error('Error during page initialization:', error);
                // Fallback initialization
                try {
                    handleHeaderVisibility();
                    setupHeaderButtons();
                } catch (fallbackError) {
                    console.error('Fallback initialization failed:', fallbackError);
                }
            }
        });
        
        // Enhanced error handling for window events
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            // Prevent error from breaking the page
            event.preventDefault();
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            // Prevent error from breaking the page
            event.preventDefault();
        });
    </script>

    <!-- Glass Footer -->
    <footer class="glass-footer" role="contentinfo" aria-label="فوتر صفحه">
        <div class="footer-content">
            <div class="footer-text">
                <i class="fas fa-heart" aria-hidden="true"></i>
                <span data-i18n="made_with_love">ساخته شده با عشق و دقت برای امنیت شما ❤️</span>
            </div>
            <nav class="footer-links" role="navigation" aria-label="لینک‌های مفید">
                <a href="#" class="footer-link" data-i18n="privacy" aria-label="حریم خصوصی">حریم خصوصی</a>
                <a href="#" class="footer-link" data-i18n="terms" aria-label="قوانین">قوانین</a>
                <a href="#" class="footer-link" data-i18n="support" aria-label="پشتیبانی">پشتیبانی</a>
                <a href="#" class="footer-link" data-i18n="about" aria-label="درباره ما">درباره ما</a>
            </nav>
        </div>
    </footer>
</body>
</html>